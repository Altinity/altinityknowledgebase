<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=http://kb.altinity.com/altinity-kb-setup-and-maintenance/cluster-production-configuration-guide/><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=icon href=/favicons/favicon.ico><title>Production Cluster Configuration Guide | Altinity® Knowledge Base for ClickHouse®</title>
<meta name=description content="Production Cluster Configuration Guide
"><meta property="og:url" content="http://kb.altinity.com/altinity-kb-setup-and-maintenance/cluster-production-configuration-guide/"><meta property="og:site_name" content="Altinity® Knowledge Base for ClickHouse®"><meta property="og:title" content="Production Cluster Configuration Guide"><meta property="og:description" content="Production Cluster Configuration Guide"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Production Cluster Configuration Guide"><meta itemprop=description content="Production Cluster Configuration Guide"><meta itemprop=dateModified content="2024-07-30T22:09:50-04:00"><meta itemprop=wordCount content="99"><meta name=twitter:card content="summary"><meta name=twitter:title content="Production Cluster Configuration Guide"><meta name=twitter:description content="Production Cluster Configuration Guide"><link rel=preload href=/scss/main.min.10f29ebcf80a650ac763f904f53e25ddad49c874d72279a3e2123ef3e2c93426.css as=style><link href=/scss/main.min.10f29ebcf80a650ac763f904f53e25ddad49c874d72279a3e2123ef3e2c93426.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><meta name=keywords content><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/4536206.js></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","v7y63vmran")</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand-xl navbar-dark"><a class=navbar-brand href=https://altinity.com target=_blank><span class=navbar-logo><img src=/images/general/altinity-logo_horizontal_blue_white.svg width=154 alt=Altinity.com></span>
</a><button class="navbar-toggler ml-auto" type=button data-bs-toggle=collapse data-bs-target=#mobile_navbar aria-controls=mobile_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="td-navbar-nav-scroll w-100 d-none d-xl-block" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown position-static"><a class="nav-link dropdown-toggle" href=# id=productsDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Products</a><ul class="dropdown-menu list-unstyled w-100 mega-menu" aria-labelledby=navbarDropdown><li><div class=grid-row style="grid-template-columns:35% 35% 30%"><div><h5 style=margin-bottom:15px>PRODUCTS</h5><div><div class=sub-section-header>Altinity.Cloud</div><div class=sub_links style="display:grid;grid-template-columns:50% 50%;margin-bottom:15px"><div><a href=https://altinity.com/managed-clickhouse/ id=nav_products_cloud class=med-link>Managed cloud</a><div class=desc>Deploy on Altinity’s cloud</div></div><div><a href=https://altinity.com/managed-clickhouse/bring-your-own-cloud/ id=nav_products_byoc class=med-link>Bring your own cloud</a><div class=desc>Any region, any environment</div></div></div><div class=sub_links style="display:grid;grid-template-columns:50% 50%;margin-bottom:20px"><div><a href=https://altinity.com/altinity-cloud-vs-clickhouse-cloud-faq id=nav_products_comparison><i class="fas fa-table text-primary"></i> Vendor comparison </a></div><div><a href=https://altinity.com/clickhouse-pricing/ id=nav_products_pricing><i class="fas fa-dollar-sign text-primary"></i> Pricing </a></div></div></div><div><div class=sub-section-header>Support for ClickHouse<sup>®</sup></div><a href=https://altinity.com/clickhouse-support/ id=nav_products_support class=med-link style=margin-bottom:10px>24/7 Support</a><br><a href=https://altinity.com/poc-evaluation-support/ id=nav_products_poc_evaluative_support class=med-link style=margin-bottom:10px>POC and Evaluative Support</a><br><a href=https://altinity.com/clickhouse-training/ id=nav_products_training class=med-link style=margin-bottom:10px>Training for ClickHouse<sup>®</sup></a><br></div></div><div style="border-left:1px solid rgba(255,255,255,.3);padding-left:30px"><h5 style=margin-bottom:15px>OPEN SOURCE SOFTWARE</h5><div style="margin-left:-10px;padding:5px 5px 5px 10px;margin-bottom:5px;background:rgba(24,157,208,.5);border-radius:8px"><a href=https://altinity.com/project-antalya-real-time-data-lakes/ id=nav_products_antalya_builds>NEW Project Antalya Builds </a><br><div class=desc style=margin-bottom:0>Scale ClickHouse queries infinitely with 10X cheaper data lakes</div></div><a href=https://altinity.com/altinity-stable/ id=nav_products_stable_builds>Altinity Stable Builds for ClickHouse<sup>®</sup> </a><br><div class=desc style=margin-bottom:15px>LTS-certified binaries with 3 years’ support</div><a href=https://altinity.com/kubernetes-operator/ id=nav_products_kubernetes>Altinity Kubernetes Operator for ClickHouse<sup>®</sup> </a><br><div class=desc style=margin-bottom:15px>Manage ClickHouse clusters on Kubernetes effortlessly</div><a href=https://altinity.com/altinity-backup-for-clickhouse/ id=nav_products_backup>Altinity Backup for ClickHouse<sup>®</sup> </a><br><div class=desc style=margin-bottom:15px>Simple backup and restore tool for ClickHouse</div><a href=https://altinity.com/ecosystem/>See more > </a></div><div style="border-left:1px solid rgba(255,255,255,.3);padding-left:30px"><h5 style=margin-bottom:15px>CLICKHOUSE<sup>®</sup> SOLUTIONS</h5><a href=https://altinity.com/observability-and-logging/ id=nav_observability>Observability & Logging </a><br><div class=desc style=margin-bottom:15px>Manage high-volume observability data efficiently</div><a href=https://altinity.com/security-information-and-event-management/ id=nav_siem>Security Information and Event Management (SIEM) </a><br><div class=desc style=margin-bottom:15px>Efficiently process and analyze high-volume security events</div><a href=https://altinity.com/trading-systems/ id=nav_trading_systems>Trading Analytics </a><br><div class=desc style=margin-bottom:15px>Make faster market decisions</div></div></div><div class=grid-row style="grid-template-columns:33% 60%;border-top:1px solid rgba(255,255,255,.3)"><div><a href=https://altinity.com/customer-stories/ id=nav_products_customer_stories>Customer stories </a><br><div class=desc>See why our customers love us</div></div><div><a href=https://altinity.com/plans-and-features-clickhouse/ id=nav_products_plans_features>Altinity Plans and Features </a><br><div class=desc>Managed service or support? Compare plans and features</div></div></div></li></ul></li><li class="nav-item dropdown position-static"><a class="nav-link dropdown-toggle" href=# id=resourceDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Resources</a><ul class="dropdown-menu list-unstyled w-100 mega-menu" aria-labelledby=navbarDropdown><li><div class=grid-row><div><p class=col-header>Developer Center</p><div><a href=https://docs.altinity.com/ target=_blank id=nav_resources_docs>Documentation </a><div class=desc>Product guides and tutorials</div><br></div><div><a href=https://kb.altinity.com/ target=_blank id=nav_resources_knowledgebase>Knowledge Base </a><div class=desc>Answers to common questions and issues</div><br></div><div><a href="https://altinity.com/blog/?cat=webinarspage" target=_blank id=nav_resources_webinars>Past Webinars </a><div class=desc>Watch anytime, on demand.</div><br></div><div><a href=https://altinity.com/developer-resources/ id=nav_resources_dev_resources>More Technical Content </a><div class=desc>How-to guides and videos</div><br></div></div><div><p class=col-header>Learning</p><div><a href=https://altinity.com/clickhouse-database/ id=nav_resources_what_is_ch>What is ClickHouse? </a><div class=desc>New to ClickHouse? Start here</div><br></div><div><a href=https://altinity.com/kubernetes-operator/ id=nav_resources_k8s_operator>Kubernetes Operator </a><div class=desc>Learn how it works and who uses it</div><br></div><div><a href=https://altinity.com/unevenly-distributed/ id=nav_unevenlydistributed>Unevenly Distributed </a><div class=desc>A Thought Leadership Series on Real-Time Data Lakes</div><br></div><div><a href=https://altinity.com/altinity-stable/ id=nav_resources_stable>Altinity Stable Builds </a><div class=desc>Learn why you should be using them in your prod environments</div><br></div></div><div><p class=col-header>Community</p><div><a href=https://altinity.com/ecosystem/ id=nav_resources_open_source>Open Source at Altinity </a><div class=desc>Explore our open source projects and contributions</div><br></div><div><a href=https://altinity.com/events/ id=nav_resources_events>Events </a><div class=desc>Upcoming conferences, events, and webinars</div><br></div><div><a href=https://altinity.com/slack/ target=_blank id=nav_resources_slack>Slack Community </a><div class=desc>Get help for any ClickHouse issue from experts</div><br></div><div><a href=https://altinity.com/office-hours-for-clickhouse/ id=nav_resources_office_hours>Monthly Office Hours </a><div class=desc>Meet our engineers live and ask your questions</div><br></div></div></div></li></ul></li><li class=nav-item><a class=nav-link href=https://altinity.com/blog target=_blank>Blog</a></li><li class="nav-item dropdown position-static"><a class="nav-link dropdown-toggle" href=# id=companyDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Company</a><ul class="dropdown-menu list-unstyled w-100 mega-menu" aria-labelledby=navbarDropdown><li><div class=grid-row><div><div><a href=https://altinity.com/about-us/ id=nav_company_about>About the company  </a></div><div><a href=https://altinity.com/about-us/#leadership id=nav_company_leadership>Leadership </a></div></div><div><div><a href=https://altinity.com/about-us/press-releases/ id=nav_company_press>Press Releases </a></div><div><a href=https://altinity.com/partners/ id=nav_company_partners>Partners </a></div></div><div><div><a href=https://altinity.com/customer-stories/ id=nav_company_customer_stories>Customer Stories </a></div><div><a href=https://altinity.com/careers/ id=nav_company_careers>Careers </a></div></div><div class=mega-bg-blue><div><h5>Get in touch with ClickHouse experts.</h5><a href=https://altinity.com/contact class="btn btn-primary button">Contact Us </a></div></div></div></li></ul></li><li class=nav-item><a class=nav-link href=https://altinity.com/contact target=_blank>Contact</a></li><li class="header-social-wrap ml-md-auto"><a class=navbar-button href=https://altinity.com/free-clickhouse-consultation/ target=_blank>Tech Support</a>
<a class=navbar-button href=https://acm.altinity.cloud/signup target=_blank style=margin-right:15px>ClickHouse® in Cloud</a>
<a href=https://www.youtube.com/@Altinity aria-label=Slack target=_blank rel="noopener noreferrer" class="social-button header-social-item"><span class=social-icon-custom-svg style=max-width:34px><svg fill="currentcolor" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><title>YouTube</title><path d="M11.109 17.625l7.562-3.906-7.562-3.953v7.859zM14 4.156c5.891.0 9.797.281 9.797.281.547.063 1.75.063 2.812 1.188.0.0.859.844 1.109 2.781.297 2.266.281 4.531.281 4.531v2.125s.016 2.266-.281 4.531c-.25 1.922-1.109 2.781-1.109 2.781-1.062 1.109-2.266 1.109-2.812 1.172.0.0-3.906.297-9.797.297v0c-7.281-.063-9.516-.281-9.516-.281-.625-.109-2.031-.078-3.094-1.188.0.0-.859-.859-1.109-2.781-.297-2.266-.281-4.531-.281-4.531v-2.125s-.016-2.266.281-4.531C.531 6.469 1.39 5.625 1.39 5.625 2.452 4.5 3.656 4.5 4.202 4.437c0 0 3.906-.281 9.797-.281v0z"/></svg>
</span></a><a href=https://altinity.com/slack/ aria-label=Slack target=_blank rel="noopener noreferrer" class="social-button header-social-item"><span class=social-icon-custom-svg style=max-width:34px><svg viewBox="0 0 36 36" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path fill="currentcolor" d="M7.563 22.747a3.782 3.782.0 11-3.78-3.78h3.78v3.78zm1.906.0a3.782 3.782.0 017.563.0v9.469a3.782 3.782.0 11-7.563.0V22.747zM13.251 7.563a3.782 3.782.0 113.782-3.78v3.78H13.251zm0 1.906a3.781 3.781.0 110 7.563H3.783a3.782 3.782.0 110-7.563h9.468zm15.183 3.782a3.783 3.783.0 113.783 3.782H28.434V13.251zm-1.9.0a3.782 3.782.0 01-7.565.0V3.783a3.782 3.782.0 117.564.0zM22.747 28.434a3.783 3.783.0 11-3.78 3.783V28.434h3.78zm0-1.9a3.782 3.782.0 010-7.565h9.469a3.782 3.782.0 110 7.564z" data-name="Icon simple-slack" id="Icon_simple-slack"/></svg>
</span></a><a href=https://github.com/altinity/ aria-label=GitHub target=_blank rel="noopener noreferrer" class="social-button header-social-item"><svg fill="currentcolor" xmlns="http://www.w3.org/2000/svg" width="24" height="28" viewBox="0 0 24 28"><title>Github</title><path d="M12 2c6.625.0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-.609.109-.828-.266-.828-.578.0-.391.016-1.687.016-3.297.0-1.125-.375-1.844-.812-2.219 2.672-.297 5.484-1.313 5.484-5.922.0-1.313-.469-2.375-1.234-3.219.125-.313.531-1.531-.125-3.187-1-.313-3.297 1.234-3.297 1.234-.953-.266-1.984-.406-3-.406s-2.047.141-3 .406c0 0-2.297-1.547-3.297-1.234-.656 1.656-.25 2.875-.125 3.187-.766.844-1.234 1.906-1.234 3.219.0 4.594 2.797 5.625 5.469 5.922-.344.313-.656.844-.766 1.609-.688.313-2.438.844-3.484-1-.656-1.141-1.844-1.234-1.844-1.234-1.172-.016-.078.734-.078.734.781.359 1.328 1.75 1.328 1.75.703 2.141 4.047 1.422 4.047 1.422.0 1 .016 1.937.016 2.234.0.313-.219.688-.828.578-4.766-1.594-8.203-6.094-8.203-11.391.0-6.625 5.375-12 12-12zM4.547 19.234c.031-.063-.016-.141-.109-.187-.094-.031-.172-.016-.203.031-.031.063.016.141.109.187.078.047.172.031.203-.031zM5.031 19.766c.063-.047.047-.156-.031-.25-.078-.078-.187-.109-.25-.047-.063.047-.047.156.031.25.078.078.187.109.25.047zM5.5 20.469c.078-.063.078-.187.0-.297-.063-.109-.187-.156-.266-.094-.078.047-.078.172.0.281s.203.156.266.109zM6.156 21.125c.063-.063.031-.203-.063-.297-.109-.109-.25-.125-.313-.047-.078.063-.047.203.063.297.109.109.25.125.313.047zM7.047 21.516c.031-.094-.063-.203-.203-.25-.125-.031-.266.016-.297.109s.063.203.203.234c.125.047.266.0.297-.094zM8.031 21.594c0-.109-.125-.187-.266-.172-.141.0-.25.078-.25.172.0.109.109.187.266.172.141.0.25-.078.25-.172zM8.937 21.438c-.016-.094-.141-.156-.281-.141-.141.031-.234.125-.219.234.016.094.141.156.281.125s.234-.125.219-.219z"/></svg></a></li></ul></div></nav><div id=mobile_navbar class="collapse js-navbar-scroll navbar-collapse d-xl-none"><ul class="menu has-collapse-sub-nav"><li class="nav-item nav-item-has-children active"><div class=drawer-nav-drop-wrap><a>Products</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=https://altinity.com/managed-clickhouse/>Altinity.Cloud</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/clickhouse-pricing/>Pricing for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/altinity-cloud-vs-clickhouse-cloud-faq/>Altinity.Cloud vs ClickHouse Cloud FAQ</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-support/>Support for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-training/>Training for ClickHouse</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=https://altinity.com/ecosystem/>Open Source Software</a></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/project-antalya-real-time-data-lakes/>Project Antalya</a></li><li class=nav-item><a href=https://altinity.com/altinity-stable/>Altinity Stable Builds</a></li><li class=nav-item><a href=https://altinity.com/kubernetes-operator/>Kubernetes Operator</a></li><li class=nav-item><a href=https://altinity.com/altinity-backup-for-clickhouse/>Altinity Backup for ClickHouse</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a>ClickHouse™ Solutions</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/observability-and-logging/>Observability & Logging with ClickHouse®</a></li><li class=nav-item><a href=https://altinity.com/security-information-and-event-management/>Security Information and Event Management (SIEM) with ClickHouse®</a></li><li class=nav-item><a href=https://altinity.com/trading-systems/>Trading analytics with ClickHouse®</a></li></ul></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a>Resources</a></div><ul class=sub-menu><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=#>Developer Center</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a target=_blank href=https://docs.altinity.com/>Documentation</a></li><li class=nav-item><a target=_blank href=https://kb.altinity.com/>Knowledge Base</a></li><li class=nav-item><a href="https://altinity.com/blog/?cat=webinarspage">Past Webinars</a></li><li class=nav-item><a href=https://altinity.com/developer-resources/>Guides and eBooks</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=#>Learning</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/clickhouse-database/>What is ClickHouse?</a></li><li class=nav-item><a href=https://altinity.com/what-is-kubernetes/>What is Kubernetes?</a></li><li class=nav-item><a href=https://altinity.com/unevenly-distributed/>Unevenly Distributed</a></li><li class=nav-item><a href=https://altinity.com/altinity-stable/>Altinity Stable Builds</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=#>Community</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/events>Events</a></li><li class="nav-slack nav-item"><a target=_blank href=http://www.localhost:10008/slack>Slack Community</a></li><li class=nav-item><a href=https://altinity.com/office-hours-for-clickhouse/>Office Hours for ClickHouse®</a></li></ul></li></ul></li><li class=nav-item><a href=https://altinity.com/blog>Blog</a></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a>Company</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/about-us/>About Altinity</a></li><li class=nav-item><a href=https://altinity.com/about-us/#leadership>Leadership</a></li><li class=nav-item><a href=https://altinity.com/about-us/press-releases/>Press Releases</a></li><li class=nav-item><a href=https://altinity.com/partners/>Partners</a></li><li class=nav-item><a href=https://altinity.com/customer-stories/>Customer Stories</a></li><li class=nav-item><a href=https://altinity.com/careers/>Careers</a></li></ul></li><li class=nav-item><a href=https://altinity.com/contact>Contact</a></li><li class="header-nav-button nav-item"><a href=https://altinity.com/free-clickhouse-consultation>Tech Support</a></li><li class="header-nav-button nav-item"><a href="https://acm.altinity.cloud/signup?__hstc=173202428.421802398cbec3b5d6457748d00d825f.1702395478849.1769622795179.1769630357065.395&__hssc=173202428.9.1769630357065&__hsfp=e5063c5ad56e06035f046e27f2ea897a">ClickHouse® in Cloud</a></li></ul></div></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/altinity-kb-setup-and-maintenance/cluster-production-configuration-guide/>Return to the regular view of this page</a>.</p></div><h1 class=title>Production Cluster Configuration Guide</h1><div class=lead>Production Cluster Configuration Guide</div><ul><li>1: <a href=#pg-202b7e3651622a4779b38f52cef739a7>Backups</a></li><li>2: <a href=#pg-8064c7d414e643fb87b3e0939260d98f>Cluster Configuration FAQ</a></li><li>3: <a href=#pg-839cbf636b5f8a35c6823f41977447f7>Cluster Configuration Process</a></li><li>4: <a href=#pg-3754a72a1a168184ed696d361b761145>Hardware Requirements</a></li><li>5: <a href=#pg-414e2937f5573cccbd17d35a64e42c62>Network Configuration</a></li></ul><div class=content><p>Moving from a single ClickHouse® server to a clustered format provides several benefits:</p><ul><li>Replication guarantees data integrity.</li><li>Provides redundancy.</li><li>Failover by being able to restart half of the nodes without encountering downtime.</li></ul><p>Moving from an unsharded ClickHouse environment to a sharded cluster requires redesign of schema and queries. Starting with a sharded cluster from the beginning makes it easier in the future to scale the cluster up.</p><p>Setting up a ClickHouse cluster for a production environment requires the following stages:</p><ul><li>Hardware Requirements</li><li>Network Configuration</li><li>Create Host Names</li><li>Monitoring Considerations</li><li>Configuration Steps</li><li>Setting Up Backups</li><li>Staging Plans</li><li>Upgrading The Cluster</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-202b7e3651622a4779b38f52cef739a7>1 - Backups</h1><div class=lead>Backups</div><p>ClickHouse® is currently at the design stage of creating some universal backup solution. Some custom backup strategies are:</p><ol><li>Each shard is backed up separately.</li><li>FREEZE the table/partition. For more information, see <a href=https://clickhouse.tech/docs/en/sql-reference/statements/alter/partition/#alter_freeze-partition target=_blank rel=nofollow>Alter Freeze Partition</a>
.<ol><li>This creates hard links in shadow subdirectory.</li></ol></li><li>rsync that directory to a backup location, then remove that subfolder from shadow.<ol><li>Cloud users are recommended to use <a href=https://rclone.org/ target=_blank>Rclone</a>
.</li></ol></li><li>Always add the full contents of the metadata subfolder that contains the current DB schema and ClickHouse configs to your backup.</li><li>For a second replica, it’s enough to copy metadata and configuration.</li><li>Data in ClickHouse is already compressed with lz4, backup can be compressed bit better, but avoid using cpu-heavy compression algorithms like gzip, use something like zstd instead.</li></ol><p>The tool automating that process: <a href=https://github.com/Altinity/clickhouse-backup target=_blank>Altinity Backup for ClickHouse</a>
.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8064c7d414e643fb87b3e0939260d98f>2 - Cluster Configuration FAQ</h1><div class=lead>Cluster Configuration FAQ</div><h2 id=clickhouse-does-not-start-some-other-unexpected-behavior-happening>ClickHouse® does not start, some other unexpected behavior happening</h2><p>Check ClickHouse logs, they are your friends:</p><p>tail -n 1000 /var/log/clickhouse-server/clickhouse-server.err.log | less
tail -n 10000 /var/log/clickhouse-server/clickhouse-server.log | less</p><h2 id=how-do-i-restrict-memory-usage>How Do I Restrict Memory Usage?</h2><p>See <a href=http://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-memory-configuration-settings/>our knowledge base article</a>
and <a href=https://clickhouse.tech/docs/en/operations/settings/query-complexity/#settings_max_memory_usage target=_blank rel=nofollow>official documentation</a>
for more information.</p><h2 id=clickhouse-died-during-big-query-execution>ClickHouse died during big query execution</h2><p>Misconfigured ClickHouse can try to allocate more RAM than is available on the system.</p><p>In that case an OS component called oomkiller can kill the ClickHouse process.</p><p>That event leaves traces inside system logs (can be checked by running dmesg command).</p><h2 id=how-do-i-make-huge-group-by-queries-use-less-ram>How Do I make huge ‘Group By’ queries use less RAM?</h2><p>Enable on disk GROUP BY (it is slower, so is disabled by default)</p><p>Set <a href=https://clickhouse.tech/docs/en/operations/settings/query-complexity/#settings-max_bytes_before_external_group_by target=_blank rel=nofollow>max_bytes_before_external_group_by</a>
to a value about 70-80% of your max_memory_usage value.</p><h2 id=data-returned-in-chunks-by-clickhouse-client>Data returned in chunks by clickhouse-client</h2><p>See <a href=http://kb.altinity.com/altinity-kb-interfaces/altinity-kb-clickhouse-client/>altinity-kb-clickhouse-client</a></p><h2 id=i-cant-connect-from-other-hosts--what-do-i-do>I Can’t Connect From Other Hosts. What do I do?</h2><p>Check the <listen>settings in config.xml. Verify that the connection can connect on both IPV4 and IPV6.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-839cbf636b5f8a35c6823f41977447f7>3 - Cluster Configuration Process</h1><div class=lead>Cluster Configuration Process</div><p>So you set up 3 nodes with zookeeper (zookeeper1, zookeeper2, zookeeper3 - <a href=https://docs.altinity.com/operationsguide/clickhouse-zookeeper/ target=_blank>How to install zookeeper?</a>
), and and 4 nodes with ClickHouse® (clickhouse-sh1r1,clickhouse-sh1r2,clickhouse-sh2r1,clickhouse-sh2r2 - <a href=https://docs.altinity.com/altinitystablerelease/stablequickstartguide/ target=_blank>how to install ClickHouse?</a>
). Now we need to make them work together.</p><p>Use ansible/puppet/salt or other systems to control the servers’ configurations.</p><ol><li>Configure ClickHouse access to Zookeeper by adding the file zookeeper.xml in /etc/clickhouse-server/config.d/ folder. This file must be placed on all ClickHouse servers.</li></ol><pre tabindex=0><code class=language-markup data-lang=markup>&lt;yandex&gt;
    &lt;zookeeper&gt;
        &lt;node&gt;
            &lt;host&gt;zookeeper1&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node&gt;
            &lt;host&gt;zookeeper2&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node&gt;
            &lt;host&gt;zookeeper3&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
    &lt;/zookeeper&gt;
&lt;/yandex&gt;
</code></pre><ol><li>On each server put the file macros.xml in <code>/etc/clickhouse-server/config.d/</code> folder.</li></ol><pre tabindex=0><code class=language-markup data-lang=markup>&lt;yandex&gt;
    &lt;!--
        That macros are defined per server,
        and they can be used in DDL, to make the DB schema cluster/server neutral
    --&gt;
    &lt;macros&gt;
        &lt;cluster&gt;prod_cluster&lt;/cluster&gt;
        &lt;shard&gt;01&lt;/shard&gt;
        &lt;replica&gt;clickhouse-sh1r1&lt;/replica&gt; &lt;!-- better - use the same as hostname  --&gt;
    &lt;/macros&gt;
&lt;/yandex&gt;
</code></pre><ol><li>On each server place the file cluster.xml in /etc/clickhouse-server/config.d/ folder. Before 20.10 ClickHouse will use default user to connect to other nodes (configurable, other users can be used), since 20.10 we recommend to use passwordless intercluster authentication based on common secret (HMAC auth)</li></ol><pre tabindex=0><code class=language-markup data-lang=markup>&lt;yandex&gt;
    &lt;remote_servers&gt;
        &lt;prod_cluster&gt; &lt;!-- you need to give a some name for a cluster --&gt;

            &lt;!--
                &lt;secret&gt;some_random_string, same on all cluster nodes, keep it safe&lt;/secret&gt;
            --&gt;
            &lt;shard&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse-sh1r1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse-sh1r2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse-sh2r1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse-sh2r2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/prod_cluster&gt;
    &lt;/remote_servers&gt;
&lt;/yandex&gt;
</code></pre><ol><li>A good practice is to create 2 additional cluster configurations similar to prod_cluster above with the following distinction: but listing all nodes of single shard (all are replicas) and as nodes of 6 different shards (no replicas)<ol><li>all-replicated: All nodes are listed as replicas in a single shard.</li><li>all-sharded: All nodes are listed as separate shards with no replicas.</li></ol></li></ol><p>Once this is complete, other queries that span nodes can be performed. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test_table_local</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>CLUSTER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;{cluster}&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>id</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>UInt8</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Engine</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>ReplicatedMergeTree</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;/clickhouse/tables/{database}/{table}/{shard}&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;{replica}&#39;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ORDER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>BY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>That will create a table on all servers in the cluster. You can insert data into this table and it will be replicated automatically to the other shards.To store the data or read the data from all shards at the same time, create a Distributed table that links to the replicatedMergeTree table.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test_table</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>CLUSTER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;{cluster}&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>Engine</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>Distributed</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;{cluster}&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;default&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;
</span></span></span></code></pre></div><h4 id=hardening-clickhouse-security><strong>Hardening ClickHouse Security</strong></h4><p><strong>See</strong> <a href=https://docs.altinity.com/operationsguide/security/ target=_blank>https://docs.altinity.com/operationsguide/security/</a></p><h3 id=additional-settings>Additional Settings</h3><p>See <a href=http://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-settings-to-adjust/>altinity-kb-settings-to-adjust</a></p><h4 id=users>Users</h4><p>Disable or add password for the default users default and readonly if your server is accessible from non-trusted networks.</p><p>If you add password to the default user, you will need to adjust cluster configuration, since the other servers need to know the default user’s should know the default user’s to connect to each other.</p><p>If you’re inside a trusted network, you can leave default user set to nothing to allow the ClickHouse nodes to communicate with each other.</p><h4 id=engines--clickhouse-building-blocks>Engines & ClickHouse building blocks</h4><p>For general explanations of roles of different engines - check the post <a href=https://github.com/yandex/ClickHouse/issues/2161 target=_blank>Distributed vs Shard vs Replicated ahhh, help me!!!</a>
.</p><h4 id=zookeeper-paths>Zookeeper Paths</h4><p>Use conventions for zookeeper paths. For example, use:</p><p>ReplicatedMergeTree(&rsquo;/clickhouse/{cluster}/tables/{shard}/table_name&rsquo;, &lsquo;{replica}&rsquo;)</p><p>for:</p><p>SELECT * FROM system.zookeeper WHERE path=&rsquo;/ &mldr;';</p><h4 id=configuration-best-practices>Configuration Best Practices</h4><table><thead><tr><th style=text-align:left><p>Attribution</p><p>Modified by a post [on GitHub by Mikhail Filimonov](https://github.com/ClickHouse/ClickHouse/issues/3607#issuecomment-440235298).</p></th></tr></thead><tbody></tbody></table><p>The following are recommended Best Practices when it comes to setting up a ClickHouse Cluster with Zookeeper:</p><ol><li>Don’t edit/overwrite default configuration files. Sometimes a newer version of ClickHouse introduces some new settings or changes the defaults in config.xml and users.xml.<ol><li>Set configurations via the extra files in conf.d directory. For example, to overwrite the interface save the file config.d/listen.xml, with the following:</li></ol></li></ol><pre tabindex=0><code class=language-markup data-lang=markup>&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;yandex&gt;
    &lt;listen_host replace=&#34;replace&#34;&gt;::&lt;/listen_host&gt;
&lt;/yandex&gt;
</code></pre><ol><li>The same is true for users. For example, change the default profile by putting the file in users.d/profile_default.xml:</li></ol><pre tabindex=0><code class=language-markup data-lang=markup>&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;yandex&gt;
    &lt;profiles&gt;
        &lt;default replace=&#34;replace&#34;&gt;
            &lt;max_memory_usage&gt;15000000000&lt;/max_memory_usage&gt;
            &lt;max_bytes_before_external_group_by&gt;12000000000&lt;/max_bytes_before_external_group_by&gt;
            &lt;max_bytes_before_external_sort&gt;12000000000&lt;/max_bytes_before_external_sort&gt;
            &lt;distributed_aggregation_memory_efficient&gt;1&lt;/distributed_aggregation_memory_efficient&gt;
            &lt;use_uncompressed_cache&gt;0&lt;/use_uncompressed_cache&gt;
            &lt;load_balancing&gt;random&lt;/load_balancing&gt;
            &lt;log_queries&gt;1&lt;/log_queries&gt;
            &lt;max_execution_time&gt;600&lt;/max_execution_time&gt;
        &lt;/default&gt;
    &lt;/profiles&gt;
&lt;/yandex&gt;
</code></pre><ol><li>Or you can create a user by putting a file users.d/user_xxx.xml (since 20.5 you can also use CREATE USER)</li></ol><pre tabindex=0><code class=language-markup data-lang=markup>&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;yandex&gt;
    &lt;users&gt;
        &lt;xxx&gt;
            &lt;!-- PASSWORD=$(base64 &lt; /dev/urandom | head -c8); echo &#34;$PASSWORD&#34;; echo -n &#34;$PASSWORD&#34; | sha256sum | tr -d &#39;-&#39; --&gt;
            &lt;password_sha256_hex&gt;...&lt;/password_sha256_hex&gt;
            &lt;networks incl=&#34;networks&#34; /&gt;
            &lt;profile&gt;readonly&lt;/profile&gt;
            &lt;quota&gt;default&lt;/quota&gt;
            &lt;allow_databases incl=&#34;allowed_databases&#34; /&gt;
        &lt;/xxx&gt;
    &lt;/users&gt;
&lt;/yandex&gt;
</code></pre><ol><li>Some parts of configuration will contain repeated elements (like allowed ips for all the users). To avoid repeating that - use substitutions file. By default its /etc/metrika.xml, but you can change it for example to /etc/clickhouse-server/substitutions.xml with the &lt;include_from> section of the main config. Put the repeated parts into substitutions file, like this:</li></ol><pre tabindex=0><code class=language-markup data-lang=markup>&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;yandex&gt;
    &lt;networks&gt;
        &lt;ip&gt;::1&lt;/ip&gt;
        &lt;ip&gt;127.0.0.1&lt;/ip&gt;
        &lt;ip&gt;10.42.0.0/16&lt;/ip&gt;
        &lt;ip&gt;192.168.0.0/24&lt;/ip&gt;
    &lt;/networks&gt;
&lt;/yandex&gt;
</code></pre><p>These files can be common for all the servers inside the cluster or can be individualized per server. If you choose to use one substitutions file per cluster, not per node, you will also need to generate the file with macros, if macros are used.</p><p>This way you have full flexibility; you’re not limited to the settings described in the template. You can change any settings per server or data center just by assigning files with some settings to that server or server group. It becomes easy to navigate, edit, and assign files.</p><h3 id=other-configuration-recommendations>Other Configuration Recommendations</h3><p>Other configurations that should be evaluated:</p><ul><li><listen>in config.xml: Determines which IP addresses and ports the ClickHouse servers listen for incoming communications.</li><li>&lt;max_memory_..> and &lt;max_bytes_before_external_&mldr;> in users.xml. These are part of the profile <default>.</li><li>&lt;max_execution_time></li><li>&lt;log_queries></li></ul><p>The following extra debug logs should be considered:</p><ul><li>part_log</li><li>text_log</li></ul><h3 id=understanding-the-configuration>Understanding The Configuration</h3><p>ClickHouse configuration stores most of its information in two files:</p><ul><li>config.xml: Stores <a href=https://clickhouse.yandex/docs/en/operations/server_settings/ target=_blank>Server configuration parameters</a>
. They are server wide, some are hierarchical , and most of them can’t be changed in runtime. The list of settings to apply without a restart changes from version to version. Some settings can be verified using system tables, for example:<ul><li>macros (system.macros)</li><li>remote_servers (system.clusters)</li></ul></li><li>users.xml: Configure users, and user level / session level <a href=https://clickhouse.yandex/docs/en/operations/settings/settings/ target=_blank>settings</a>
.<ul><li>Each user can change these during their session by:<ul><li>Using parameter in http query</li><li>By using parameter for clickhouse-client</li><li>Sending query like set allow_experimental_data_skipping_indices=1.</li></ul></li><li>Those settings and their current values are visible in system.settings. You can make some settings global by editing default profile in users.xml, which does not need restart.</li><li>You can forbid users to change their settings by using readonly=2 for that user, or using <a href=https://clickhouse.yandex/docs/en/operations/settings/constraints_on_settings/ target=_blank>setting constraints</a>
.</li><li>Changes in users.xml are applied w/o restart.</li></ul></li></ul><p>For both config.xml and users.xml, it’s preferable to put adjustments in the config.d and users.d subfolders instead of editing config.xml and users.xml directly.</p><p>You can check if the config file was reread by checking /var/lib/clickhouse/preprocessed_configs/ folder.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3754a72a1a168184ed696d361b761145>4 - Hardware Requirements</h1><div class=lead>Hardware Requirements</div><h3 id=clickhouse>ClickHouse®</h3><p>ClickHouse will use all available hardware to maximize performance. So the more hardware - the better. As of this publication, the hardware requirements are:</p><ul><li>Minimum Hardware: 4-core CPU with support of SSE4.2, 16 Gb RAM, 1Tb HDD.<ul><li>Recommended for development and staging environments.</li><li>SSE4.2 is required, and going below 4 Gb of RAM is not recommended.</li></ul></li><li>Recommended Hardware: >=16-cores, >=64Gb RAM, HDD-raid or SSD.<ul><li>For processing up to hundreds of millions / billions of rows.</li></ul></li></ul><p>For clouds: disk throughput is the more important factor compared to IOPS. Be aware of burst / baseline disk speed difference.</p><p>See also: <a href=https://benchmark.clickhouse.com/hardware/ target=_blank rel=nofollow>https://benchmark.clickhouse.com/hardware/</a></p><h3 id=zookeeper><strong>Zookeeper</strong></h3><p>Zookeeper requires separate servers from those used for ClickHouse. Zookeeper has poor performance when installed on the same node as ClickHouse.</p><p>Hardware Requirements for Zookeeper:</p><ul><li>Fast disk speed (ideally NVMe, 128Gb should be enough).</li><li>Any modern CPU (one core, better 2)</li><li>4Gb of RAM</li></ul><p>For clouds - be careful with burstable network disks (like gp2 on aws): you may need up to 1000 IOPs on the disk for on a long run, so gp3 with 3000 IOPs baseline is a better choice.</p><p>The number of Zookeeper instances depends on the environment:</p><ul><li>Production: 3 is an optimal number of zookeeper instances.</li><li>Development and Staging: 1 zookeeper instance is sufficient.</li></ul><p>See also:</p><ul><li><a href=https://docs.altinity.com/operationsguide/clickhouse-zookeeper/ target=_blank>https://docs.altinity.com/operationsguide/clickhouse-zookeeper/</a></li><li><a href=http://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-zookeeper/altinity-kb-proper-setup/>altinity-kb-proper-setup</a></li><li><a href=http://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-zookeeper/zookeeper-monitoring/>zookeeper-monitoring</a></li></ul><h4 id=clickhouse-hardware-configuration>ClickHouse Hardware Configuration</h4><p>Configure the servers according to those recommendations on the <a href=https://clickhouse.com/docs/en/operations/tips/ target=_blank rel=nofollow>ClickHouse Usage Recommendations</a>
.</p><h4 id=test-your-hardware><strong>Test Your Hardware</strong></h4><p>Be sure to test the following:</p><ul><li>RAM speed.</li><li>Network speed.</li><li>Storage speed.</li></ul><p>It’s better to find any performance issues before installing ClickHouse.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-414e2937f5573cccbd17d35a64e42c62>5 - Network Configuration</h1><div class=lead>Network Configuration</div><h3 id=networking-and-server-room-planning><strong>Networking And Server Room Planning</strong></h3><p>The network used for your ClickHouse® cluster should be a fast network, ideally 10 Gbit or more.
ClickHouse nodes generate a lot of traffic to exchange the data between nodes (port 9009 for replication, and 9000 for distributed queries).
Zookeeper traffic in normal circumstances is moderate, but in some special cases can also be very significant.</p><p>For the zookeeper low latency is more important than bandwidth.</p><p>Keep the replicas isolated on the hardware level. This allows for cluster failover from possible outages.</p><ul><li>For Physical Environments: Avoid placing 2 ClickHouse replicas on the same server rack. Ideally, they should be on isolated network switches and an isolated power supply.</li><li>For Clouds Environments: Use different availability zones between the ClickHouse replicas when possible (but be aware of the interzone traffic costs)</li></ul><p>These considerations are the same as the Zookeeper nodes.</p><p>For example:</p><table><thead><tr><th style=text-align:left><strong>Rack</strong></th><th style=text-align:left><strong>Server</strong></th><th style=text-align:left><strong>Server</strong></th><th style=text-align:left><strong>Server</strong></th><th style=text-align:left><strong>Server</strong></th></tr></thead><tbody><tr><td style=text-align:left><strong>Rack 1</strong></td><td style=text-align:left><strong>CH_SHARD1_R1</strong></td><td style=text-align:left><strong>CH_SHARD2_R1</strong></td><td style=text-align:left><strong>CH_SHARD3_R1</strong></td><td style=text-align:left><strong>ZOO_1</strong></td></tr><tr><td style=text-align:left><strong>Rack 2</strong></td><td style=text-align:left><strong>CH_SHARD1_R2</strong></td><td style=text-align:left><strong>CH_SHARD2_R2</strong></td><td style=text-align:left><strong>CH_SHARD3_R2</strong></td><td style=text-align:left><strong>ZOO_2</strong></td></tr><tr><td style=text-align:left><strong>Rack 3</strong></td><td style=text-align:left><strong>ZOO3</strong></td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td></tr></tbody></table><h4 id=network-ports-and-firewall><strong>Network Ports And Firewall</strong></h4><p>ClickHouse listens the following ports:</p><ul><li>9000: clickhouse-client, native clients, other clickhouse-servers connect to here.</li><li>8123: HTTP clients</li><li>9009: Other replicas will connect here to download data.</li></ul><p>For more information, see <a href=https://www.altinity.com/blog/2019/3/15/clickhouse-networking-part-1 target=_blank>CLICKHOUSE NETWORKING, PART 1</a>
.</p><p>Zookeeper listens the following ports:</p><ul><li>2181: Client connections.</li><li>2888: Inter-ensemble connections.</li><li>3888: Leader election.</li></ul><p>Outbound traffic from ClickHouse connects to the following ports:</p><ul><li>ZooKeeper: On port 2181.</li><li>Other CH nodes in the cluster: On port 9000 and 9009.</li><li>Dictionary sources: Depending on what was configured such as HTTP, MySQL, Mongo, etc.</li><li>Kafka or Hadoop: If those integrations were enabled.</li></ul><h3 id=ssl><strong>SSL</strong></h3><p>For non-trusted networks enable SSL/HTTPS. If acceptable, it is better to keep interserver communications unencrypted for performance reasons.</p><h3 id=naming-schema><strong>Naming Schema</strong></h3><p>The best time to start creating a naming schema for the servers is before they’re created and configured.</p><p>There are a few features based on good server naming in ClickHouse:</p><ul><li>clickhouse-client prompts: Allows a different prompt for clickhouse-client per server hostname.</li><li>Nearest hostname load balancing: For more information, see <a href=https://clickhouse.yandex/docs/en/operations/settings/settings/#load_balancing-nearest_hostname target=_blank>Nearest Hostname</a>
.</li></ul><p>A good option is to use the following:</p><p>{datacenter}-{serverroom}-{rack identifier}-{clickhouse cluster identifier}-{shard number or server number}.</p><p>Other examples:</p><ul><li>rxv-olap-ch-master-sh01-r01:<ul><li>rxv - location (rack#15)</li><li>olap - product name</li><li>ch = clickhouse</li><li>master = stage</li><li>sh01 = shard 1</li><li>r01 = replica 1</li></ul></li><li>hetnzerde1-ch-prod-01.local:<ul><li>hetnzerde1 - location (also replica id)</li><li>ch = clickhouse</li><li>prod = stage</li><li>01 - server number / shard number in that DC</li></ul></li><li>sh01.ch-front.dev.aws-east1a.example.com:<ul><li>sh01 - shard 01</li><li>ch-front - cluster name</li><li>dev = stage</li><li>aws = cloud provider</li><li>east1a = region and availability zone</li></ul></li></ul><h4 id=host-name-references><strong>Host Name References</strong></h4><ul><li><a href=https://stackoverflow.com/a/39336460/1555175 target=_blank>What are the best practices for domain names (dev, staging, production)?</a></li><li><a href=https://www.replex.io/blog/9-best-practices-and-examples-for-working-with-kubernetes-labels target=_blank>9 Best Practices and Examples for Working with Kubernetes Labels</a></li><li><a href=https://devcentral.f5.com/s/articles/thoughts-on-hostname-nomenclature target=_blank>Thoughts On Hostname Nomenclature</a></li></ul><h3 id=additional-hostname-tips><strong>Additional Hostname Tips</strong></h3><ul><li>Hostnames configured on the server should not change. If you do need to change the host name, one reference to use is <a href=https://linuxize.com/post/how-to-change-hostname-on-ubuntu-18-04/ target=_blank>How to Change Hostname on Ubuntu 18.04</a>
.</li><li>The server should be accessible to other servers in the cluster via it’s hostname. Otherwise you will need to configure interserver_hostname in your config.</li><li>Ensure that <code>hostname --fqdn</code> and <code>getent hosts $(hostname --fqdn)</code> return the correct name and ip.</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class="row footer-inner pb-3"><div class=col-12><a href=https://altinity.com target=_blank><img src=/images/general/altinity-logo_horizontal_blue_white.svg width=154 alt=Altinity.com></a></div></div><div class="row footer-inner py-3"><div class="col-12 col-sm-6 col-md-3"><ul class="nav flex-column mb-3"><li class=nav-item><b>PRODUCT</b></li><li class=nav-item><a href=https://altinity.com/managed-clickhouse/ target=_blank>Altinity.Cloud</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-support/ target=_blank>Support for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-training target=_blank>Training for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-pricing/ target=_blank>Altinity.Cloud Pricing</a></li><li class=nav-item><a href=https://altinity.com/plans-and-features-clickhouse/ target=_blank>Altinity Plans and Features</a></li></ul><div class="d-none d-md-block mb-3"><img decoding=async style="width:60px;display:inline-block;margin:0 10px 0 0" src=/images/general/soc.webp alt="SOC Certified"><img decoding=async style=width:60px;display:inline-block;margin:0 src=/images/general/soc2.webp alt="SOC2 TYPE II Certified"></div></div><div class="col-12 col-sm-6 col-md-3"><ul class="nav flex-column mb-3"><li class=nav-item><b>RESOURCES</b></li><li class=nav-item><a href=https://altinity.com/blog target=_blank>Blog</a></li><li class=nav-item><a href=https://docs.altinity.com/ target=_blank>Documentation</a></li><li class=nav-item><a href=https://kb.altinity.com/ target=_blank>Knowledge Base</a></li><li class=nav-item><a href=https://altinity.com/releases target=_blank>Altinity Stable Builds</a></li><li class=nav-item><a href=https://hubs.la/Q02pLTV20 target=_blank>Kubernetes Operator</a></li><li class=nav-item><a href=https://altinity.com/ecosystem/ target=_blank>Altinity Open Source Projects</a></li><li class=nav-item><a href=https://altinity.com/events/ target=_blank>Events</a></li></ul></div><div class="col-12 col-sm-6 col-md-3"><ul class="nav flex-column mb-3"><li class=nav-item><b>COMPANY</b></li><li class=nav-item><a href=https://altinity.com/about-us/ target=_blank>About Altinity</a></li><li class=nav-item><a href=https://altinity.com/about-us/press-releases target=_blank>Press Releases</a></li><li class=nav-item><a href=https://altinity.com/partners/ target=_blank>Partners</a></li><li class=nav-item><a href=https://altinity.com/customer-stories/ target=_blank>Customer Stories</a></li><li class=nav-item><a href=https://altinity.com/careers/ target=_blank>Careers</a></li><li class=nav-item><a href=https://altinity.com/contact/ target=_blank>Contact Us</a></li></ul></div><div class="col-12 col-sm-6 col-md-3">Get the latest ClickHouse news straight to your inbox every month.<br><a href=https://altinity.com/newsletter/ target=_blank class="btn btn-primary my-3" style=border-radius:1.5rem>Sign Up</a></div></div></div><div class="row footer-inner pb-3"><div class="col-12 col-sm-6 text-left text-xs-center py-2"><small class=text-white>&copy; 2026 Altinity Inc. Altinity®, Altinity.Cloud®, and Altinity Stable® are registered trademarks of Altinity, Inc. ClickHouse® is a registered trademark of ClickHouse, Inc.; Altinity is not affiliated with or associated with ClickHouse, Inc. Kafka, Kubernetes, MySQL, and PostgreSQL are trademarks and property of their respective owners. All Rights Reserved</small>
<small class=ml-1><a href=https://altinity.com/privacy-policy/ target=_blank>Privacy Policy</a></small></div><div class="col-12 col-sm-6 text-end text-xs-center"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://altinity.com/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=X aria-label=X><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/AltinityDB><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/company/altinity/><i class="fab fa-linkedin"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.youtube.com/channel/UCE3Y2lDKl_ZfjaCrh62onYA><i class="fab fa-youtube"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/Altinity/altinityknowledgebase><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Reddit aria-label=Reddit><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.reddit.com/r/Clickhouse/><i class="fab fa-reddit"></i></a></li></ul></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-101676615-2"></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/4536206.js></script><script type=text/javascript>!function(){var e,t="06536e793668baa",n=function(){Reo.init({clientID:"06536e793668baa"})};(e=document.createElement("script")).src="https://static.reo.dev/"+t+"/reo.js",e.defer=!0,e.onload=n,document.head.appendChild(e)}()</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-101676615-2")</script><script>$(document).ready(function(){$(".mobile-drop-toggle").on("click",function(){$(this).parent().parent().toggleClass("active")})})</script></footer><script type=text/javascript>_linkedin_partner_id="1601132",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id)</script><script type=text/javascript>(function(e){e||(window.lintrk=function(e,t){window.lintrk.q.push([e,t])},window.lintrk.q=[]);var n=document.getElementsByTagName("script")[0],t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",n.parentNode.insertBefore(t,n)})(window.lintrk)</script><noscript><img height=1 width=1 style=display:none alt src="https://px.ads.linkedin.com/collect/?pid=1601132&fmt=gif"></noscript></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>