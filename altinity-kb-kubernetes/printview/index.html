<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=http://kb.altinity.com/altinity-kb-kubernetes/><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=icon href=/favicons/favicon.ico><title>Using the Altinity Kubernetes Operator for ClickHouse® | Altinity® Knowledge Base for ClickHouse®</title>
<meta name=description content="Run ClickHouse® in Kubernetes without any issues.
"><meta property="og:url" content="http://kb.altinity.com/altinity-kb-kubernetes/"><meta property="og:site_name" content="Altinity® Knowledge Base for ClickHouse®"><meta property="og:title" content="Using the Altinity Kubernetes Operator for ClickHouse®"><meta property="og:description" content="Run ClickHouse® in Kubernetes without any issues."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Using the Altinity Kubernetes Operator for ClickHouse®"><meta itemprop=description content="Run ClickHouse® in Kubernetes without any issues."><meta itemprop=dateModified content="2024-12-03T11:51:05-05:00"><meta itemprop=wordCount content="2050"><meta itemprop=keywords content="clickhouse in kubernetes,kubernetes issues,ALtinity Kubernetes operator for ClickHouse"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using the Altinity Kubernetes Operator for ClickHouse®"><meta name=twitter:description content="Run ClickHouse® in Kubernetes without any issues."><link rel=preload href=/scss/main.min.10f29ebcf80a650ac763f904f53e25ddad49c874d72279a3e2123ef3e2c93426.css as=style><link href=/scss/main.min.10f29ebcf80a650ac763f904f53e25ddad49c874d72279a3e2123ef3e2c93426.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><meta name=keywords content="clickhouse in kubernetes,kubernetes issues,ALtinity Kubernetes operator for ClickHouse"><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/4536206.js></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","v7y63vmran")</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand-xl navbar-dark"><a class=navbar-brand href=https://altinity.com target=_blank><span class=navbar-logo><img src=/images/general/altinity-logo_horizontal_blue_white.svg width=154 alt=Altinity.com></span>
</a><button class="navbar-toggler ml-auto" type=button data-bs-toggle=collapse data-bs-target=#mobile_navbar aria-controls=mobile_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="td-navbar-nav-scroll w-100 d-none d-xl-block" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown position-static"><a class="nav-link dropdown-toggle" href=# id=productsDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Products</a><ul class="dropdown-menu list-unstyled w-100 mega-menu" aria-labelledby=navbarDropdown><li><div class=grid-row style="grid-template-columns:35% 35% 30%"><div><h5 style=margin-bottom:15px>PRODUCTS</h5><div><div class=sub-section-header>Altinity.Cloud</div><div class=sub_links style="display:grid;grid-template-columns:50% 50%;margin-bottom:15px"><div><a href=https://altinity.com/managed-clickhouse/ id=nav_products_cloud class=med-link>Managed cloud</a><div class=desc>Deploy on Altinity’s cloud</div></div><div><a href=https://altinity.com/managed-clickhouse/bring-your-own-cloud/ id=nav_products_byoc class=med-link>Bring your own cloud</a><div class=desc>Any region, any environment</div></div></div><div class=sub_links style="display:grid;grid-template-columns:50% 50%;margin-bottom:20px"><div><a href=https://altinity.com/altinity-cloud-vs-clickhouse-cloud-faq id=nav_products_comparison><i class="fas fa-table text-primary"></i> Vendor comparison </a></div><div><a href=https://altinity.com/clickhouse-pricing/ id=nav_products_pricing><i class="fas fa-dollar-sign text-primary"></i> Pricing </a></div></div></div><div><div class=sub-section-header>Support for ClickHouse<sup>®</sup></div><a href=https://altinity.com/clickhouse-support/ id=nav_products_support class=med-link style=margin-bottom:10px>24/7 Support</a><br><a href=https://altinity.com/poc-evaluation-support/ id=nav_products_poc_evaluative_support class=med-link style=margin-bottom:10px>POC and Evaluative Support</a><br><a href=https://altinity.com/clickhouse-training/ id=nav_products_training class=med-link style=margin-bottom:10px>Training for ClickHouse<sup>®</sup></a><br></div></div><div style="border-left:1px solid rgba(255,255,255,.3);padding-left:30px"><h5 style=margin-bottom:15px>OPEN SOURCE SOFTWARE</h5><div style="margin-left:-10px;padding:5px 5px 5px 10px;margin-bottom:5px;background:rgba(24,157,208,.5);border-radius:8px"><a href=https://altinity.com/project-antalya-real-time-data-lakes/ id=nav_products_antalya_builds>NEW Project Antalya Builds </a><br><div class=desc style=margin-bottom:0>Scale ClickHouse queries infinitely with 10X cheaper data lakes</div></div><a href=https://altinity.com/altinity-stable/ id=nav_products_stable_builds>Altinity Stable Builds for ClickHouse<sup>®</sup> </a><br><div class=desc style=margin-bottom:15px>LTS-certified binaries with 3 years’ support</div><a href=https://altinity.com/kubernetes-operator/ id=nav_products_kubernetes>Altinity Kubernetes Operator for ClickHouse<sup>®</sup> </a><br><div class=desc style=margin-bottom:15px>Manage ClickHouse clusters on Kubernetes effortlessly</div><a href=https://altinity.com/altinity-backup-for-clickhouse/ id=nav_products_backup>Altinity Backup for ClickHouse<sup>®</sup> </a><br><div class=desc style=margin-bottom:15px>Simple backup and restore tool for ClickHouse</div><a href=https://altinity.com/ecosystem/>See more > </a></div><div style="border-left:1px solid rgba(255,255,255,.3);padding-left:30px"><h5 style=margin-bottom:15px>CLICKHOUSE<sup>®</sup> SOLUTIONS</h5><a href=https://altinity.com/observability-and-logging/ id=nav_observability>Observability & Logging </a><br><div class=desc style=margin-bottom:15px>Manage high-volume observability data efficiently</div><a href=https://altinity.com/security-information-and-event-management/ id=nav_siem>Security Information and Event Management (SIEM) </a><br><div class=desc style=margin-bottom:15px>Efficiently process and analyze high-volume security events</div><a href=https://altinity.com/trading-systems/ id=nav_trading_systems>Trading Analytics </a><br><div class=desc style=margin-bottom:15px>Make faster market decisions</div></div></div><div class=grid-row style="grid-template-columns:33% 60%;border-top:1px solid rgba(255,255,255,.3)"><div><a href=https://altinity.com/customer-stories/ id=nav_products_customer_stories>Customer stories </a><br><div class=desc>See why our customers love us</div></div><div><a href=https://altinity.com/plans-and-features-clickhouse/ id=nav_products_plans_features>Altinity Plans and Features </a><br><div class=desc>Managed service or support? Compare plans and features</div></div></div></li></ul></li><li class="nav-item dropdown position-static"><a class="nav-link dropdown-toggle" href=# id=resourceDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Resources</a><ul class="dropdown-menu list-unstyled w-100 mega-menu" aria-labelledby=navbarDropdown><li><div class=grid-row><div><p class=col-header>Developer Center</p><div><a href=https://docs.altinity.com/ target=_blank id=nav_resources_docs>Documentation </a><div class=desc>Product guides and tutorials</div><br></div><div><a href=https://kb.altinity.com/ target=_blank id=nav_resources_knowledgebase>Knowledge Base </a><div class=desc>Answers to common questions and issues</div><br></div><div><a href="https://altinity.com/blog/?cat=webinarspage" target=_blank id=nav_resources_webinars>Past Webinars </a><div class=desc>Watch anytime, on demand.</div><br></div><div><a href=https://altinity.com/developer-resources/ id=nav_resources_dev_resources>More Technical Content </a><div class=desc>How-to guides and videos</div><br></div></div><div><p class=col-header>Learning</p><div><a href=https://altinity.com/clickhouse-database/ id=nav_resources_what_is_ch>What is ClickHouse? </a><div class=desc>New to ClickHouse? Start here</div><br></div><div><a href=https://altinity.com/kubernetes-operator/ id=nav_resources_k8s_operator>Kubernetes Operator </a><div class=desc>Learn how it works and who uses it</div><br></div><div><a href=https://altinity.com/unevenly-distributed/ id=nav_unevenlydistributed>Unevenly Distributed </a><div class=desc>A Thought Leadership Series on Real-Time Data Lakes</div><br></div><div><a href=https://altinity.com/altinity-stable/ id=nav_resources_stable>Altinity Stable Builds </a><div class=desc>Learn why you should be using them in your prod environments</div><br></div></div><div><p class=col-header>Community</p><div><a href=https://altinity.com/ecosystem/ id=nav_resources_open_source>Open Source at Altinity </a><div class=desc>Explore our open source projects and contributions</div><br></div><div><a href=https://altinity.com/events/ id=nav_resources_events>Events </a><div class=desc>Upcoming conferences, events, and webinars</div><br></div><div><a href=https://altinity.com/slack/ target=_blank id=nav_resources_slack>Slack Community </a><div class=desc>Get help for any ClickHouse issue from experts</div><br></div><div><a href=https://altinity.com/office-hours-for-clickhouse/ id=nav_resources_office_hours>Monthly Office Hours </a><div class=desc>Meet our engineers live and ask your questions</div><br></div></div></div></li></ul></li><li class=nav-item><a class=nav-link href=https://altinity.com/blog target=_blank>Blog</a></li><li class="nav-item dropdown position-static"><a class="nav-link dropdown-toggle" href=# id=companyDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Company</a><ul class="dropdown-menu list-unstyled w-100 mega-menu" aria-labelledby=navbarDropdown><li><div class=grid-row><div><div><a href=https://altinity.com/about-us/ id=nav_company_about>About the company  </a></div><div><a href=https://altinity.com/about-us/#leadership id=nav_company_leadership>Leadership </a></div></div><div><div><a href=https://altinity.com/about-us/press-releases/ id=nav_company_press>Press Releases </a></div><div><a href=https://altinity.com/partners/ id=nav_company_partners>Partners </a></div></div><div><div><a href=https://altinity.com/customer-stories/ id=nav_company_customer_stories>Customer Stories </a></div><div><a href=https://altinity.com/careers/ id=nav_company_careers>Careers </a></div></div><div class=mega-bg-blue><div><h5>Get in touch with ClickHouse experts.</h5><a href=https://altinity.com/contact class="btn btn-primary button">Contact Us </a></div></div></div></li></ul></li><li class=nav-item><a class=nav-link href=https://altinity.com/contact target=_blank>Contact</a></li><li class="header-social-wrap ml-md-auto"><a class=navbar-button href=https://altinity.com/free-clickhouse-consultation/ target=_blank>Tech Support</a>
<a class=navbar-button href=https://acm.altinity.cloud/signup target=_blank style=margin-right:15px>ClickHouse® in Cloud</a>
<a href=https://www.youtube.com/@Altinity aria-label=Slack target=_blank rel="noopener noreferrer" class="social-button header-social-item"><span class=social-icon-custom-svg style=max-width:34px><svg fill="currentcolor" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><title>YouTube</title><path d="M11.109 17.625l7.562-3.906-7.562-3.953v7.859zM14 4.156c5.891.0 9.797.281 9.797.281.547.063 1.75.063 2.812 1.188.0.0.859.844 1.109 2.781.297 2.266.281 4.531.281 4.531v2.125s.016 2.266-.281 4.531c-.25 1.922-1.109 2.781-1.109 2.781-1.062 1.109-2.266 1.109-2.812 1.172.0.0-3.906.297-9.797.297v0c-7.281-.063-9.516-.281-9.516-.281-.625-.109-2.031-.078-3.094-1.188.0.0-.859-.859-1.109-2.781-.297-2.266-.281-4.531-.281-4.531v-2.125s-.016-2.266.281-4.531C.531 6.469 1.39 5.625 1.39 5.625 2.452 4.5 3.656 4.5 4.202 4.437c0 0 3.906-.281 9.797-.281v0z"/></svg>
</span></a><a href=https://altinity.com/slack/ aria-label=Slack target=_blank rel="noopener noreferrer" class="social-button header-social-item"><span class=social-icon-custom-svg style=max-width:34px><svg viewBox="0 0 36 36" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path fill="currentcolor" d="M7.563 22.747a3.782 3.782.0 11-3.78-3.78h3.78v3.78zm1.906.0a3.782 3.782.0 017.563.0v9.469a3.782 3.782.0 11-7.563.0V22.747zM13.251 7.563a3.782 3.782.0 113.782-3.78v3.78H13.251zm0 1.906a3.781 3.781.0 110 7.563H3.783a3.782 3.782.0 110-7.563h9.468zm15.183 3.782a3.783 3.783.0 113.783 3.782H28.434V13.251zm-1.9.0a3.782 3.782.0 01-7.565.0V3.783a3.782 3.782.0 117.564.0zM22.747 28.434a3.783 3.783.0 11-3.78 3.783V28.434h3.78zm0-1.9a3.782 3.782.0 010-7.565h9.469a3.782 3.782.0 110 7.564z" data-name="Icon simple-slack" id="Icon_simple-slack"/></svg>
</span></a><a href=https://github.com/altinity/ aria-label=GitHub target=_blank rel="noopener noreferrer" class="social-button header-social-item"><svg fill="currentcolor" xmlns="http://www.w3.org/2000/svg" width="24" height="28" viewBox="0 0 24 28"><title>Github</title><path d="M12 2c6.625.0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-.609.109-.828-.266-.828-.578.0-.391.016-1.687.016-3.297.0-1.125-.375-1.844-.812-2.219 2.672-.297 5.484-1.313 5.484-5.922.0-1.313-.469-2.375-1.234-3.219.125-.313.531-1.531-.125-3.187-1-.313-3.297 1.234-3.297 1.234-.953-.266-1.984-.406-3-.406s-2.047.141-3 .406c0 0-2.297-1.547-3.297-1.234-.656 1.656-.25 2.875-.125 3.187-.766.844-1.234 1.906-1.234 3.219.0 4.594 2.797 5.625 5.469 5.922-.344.313-.656.844-.766 1.609-.688.313-2.438.844-3.484-1-.656-1.141-1.844-1.234-1.844-1.234-1.172-.016-.078.734-.078.734.781.359 1.328 1.75 1.328 1.75.703 2.141 4.047 1.422 4.047 1.422.0 1 .016 1.937.016 2.234.0.313-.219.688-.828.578-4.766-1.594-8.203-6.094-8.203-11.391.0-6.625 5.375-12 12-12zM4.547 19.234c.031-.063-.016-.141-.109-.187-.094-.031-.172-.016-.203.031-.031.063.016.141.109.187.078.047.172.031.203-.031zM5.031 19.766c.063-.047.047-.156-.031-.25-.078-.078-.187-.109-.25-.047-.063.047-.047.156.031.25.078.078.187.109.25.047zM5.5 20.469c.078-.063.078-.187.0-.297-.063-.109-.187-.156-.266-.094-.078.047-.078.172.0.281s.203.156.266.109zM6.156 21.125c.063-.063.031-.203-.063-.297-.109-.109-.25-.125-.313-.047-.078.063-.047.203.063.297.109.109.25.125.313.047zM7.047 21.516c.031-.094-.063-.203-.203-.25-.125-.031-.266.016-.297.109s.063.203.203.234c.125.047.266.0.297-.094zM8.031 21.594c0-.109-.125-.187-.266-.172-.141.0-.25.078-.25.172.0.109.109.187.266.172.141.0.25-.078.25-.172zM8.937 21.438c-.016-.094-.141-.156-.281-.141-.141.031-.234.125-.219.234.016.094.141.156.281.125s.234-.125.219-.219z"/></svg></a></li></ul></div></nav><div id=mobile_navbar class="collapse js-navbar-scroll navbar-collapse d-xl-none"><ul class="menu has-collapse-sub-nav"><li class="nav-item nav-item-has-children active"><div class=drawer-nav-drop-wrap><a>Products</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=https://altinity.com/managed-clickhouse/>Altinity.Cloud</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/clickhouse-pricing/>Pricing for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/altinity-cloud-vs-clickhouse-cloud-faq/>Altinity.Cloud vs ClickHouse Cloud FAQ</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-support/>Support for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-training/>Training for ClickHouse</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=https://altinity.com/ecosystem/>Open Source Software</a></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/project-antalya-real-time-data-lakes/>Project Antalya</a></li><li class=nav-item><a href=https://altinity.com/altinity-stable/>Altinity Stable Builds</a></li><li class=nav-item><a href=https://altinity.com/kubernetes-operator/>Kubernetes Operator</a></li><li class=nav-item><a href=https://altinity.com/altinity-backup-for-clickhouse/>Altinity Backup for ClickHouse</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a>ClickHouse™ Solutions</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/observability-and-logging/>Observability & Logging with ClickHouse®</a></li><li class=nav-item><a href=https://altinity.com/security-information-and-event-management/>Security Information and Event Management (SIEM) with ClickHouse®</a></li><li class=nav-item><a href=https://altinity.com/trading-systems/>Trading analytics with ClickHouse®</a></li></ul></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a>Resources</a></div><ul class=sub-menu><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=#>Developer Center</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a target=_blank href=https://docs.altinity.com/>Documentation</a></li><li class=nav-item><a target=_blank href=https://kb.altinity.com/>Knowledge Base</a></li><li class=nav-item><a href="https://altinity.com/blog/?cat=webinarspage">Past Webinars</a></li><li class=nav-item><a href=https://altinity.com/developer-resources/>Guides and eBooks</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=#>Learning</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/clickhouse-database/>What is ClickHouse?</a></li><li class=nav-item><a href=https://altinity.com/what-is-kubernetes/>What is Kubernetes?</a></li><li class=nav-item><a href=https://altinity.com/unevenly-distributed/>Unevenly Distributed</a></li><li class=nav-item><a href=https://altinity.com/altinity-stable/>Altinity Stable Builds</a></li></ul></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a href=#>Community</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/events>Events</a></li><li class="nav-slack nav-item"><a target=_blank href=http://www.localhost:10008/slack>Slack Community</a></li><li class=nav-item><a href=https://altinity.com/office-hours-for-clickhouse/>Office Hours for ClickHouse®</a></li></ul></li></ul></li><li class=nav-item><a href=https://altinity.com/blog>Blog</a></li><li class="nav-item nav-item-has-children"><div class=drawer-nav-drop-wrap><a>Company</a><span class=mobile-drop-toggle></span></div><ul class=sub-menu><li class=nav-item><a href=https://altinity.com/about-us/>About Altinity</a></li><li class=nav-item><a href=https://altinity.com/about-us/#leadership>Leadership</a></li><li class=nav-item><a href=https://altinity.com/about-us/press-releases/>Press Releases</a></li><li class=nav-item><a href=https://altinity.com/partners/>Partners</a></li><li class=nav-item><a href=https://altinity.com/customer-stories/>Customer Stories</a></li><li class=nav-item><a href=https://altinity.com/careers/>Careers</a></li></ul></li><li class=nav-item><a href=https://altinity.com/contact>Contact</a></li><li class="header-nav-button nav-item"><a href=https://altinity.com/free-clickhouse-consultation>Tech Support</a></li><li class="header-nav-button nav-item"><a href="https://acm.altinity.cloud/signup?__hstc=173202428.421802398cbec3b5d6457748d00d825f.1702395478849.1769622795179.1769630357065.395&__hssc=173202428.9.1769630357065&__hsfp=e5063c5ad56e06035f046e27f2ea897a">ClickHouse® in Cloud</a></li></ul></div></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/altinity-kb-kubernetes/>Return to the regular view of this page</a>.</p></div><h1 class=title>Using the Altinity Kubernetes Operator for ClickHouse®</h1><div class=lead>Run ClickHouse® in Kubernetes without any issues.</div><ul><li>1: <a href=#pg-2b3d7fdcfbffa725421e792b4bb3c072>Istio Issues</a></li></ul><div class=content><h2 id=useful-links>Useful links</h2><p>The Altinity Kubernetes Operator for ClickHouse® repo has very useful documentation:</p><ul><li><a href=https://github.com/Altinity/clickhouse-operator/blob/master/docs/quick_start.md target=_blank>Quick Start Guide</a></li><li><a href=https://github.com/Altinity/clickhouse-operator/blob/master/docs/custom_resource_explained.md target=_blank>Operator Custom Resource Definition explained</a></li><li><a href=https://github.com/Altinity/clickhouse-operator/tree/master/docs/chi-examples target=_blank>Examples - YAML files to deploy the operator in many common configurations</a></li><li><a href=https://github.com/Altinity/clickhouse-operator/tree/master/docs#table-of-contents target=_blank>Main documentation</a></li></ul><h2 id=clickhouse-operator-ip-filter>ClickHouse Operator ip filter</h2><ul><li>In the current version of operator default user is limited to IP addresses of the cluster pods. We plan to have a password option for 0.20.0 and use a &lsquo;secret&rsquo; authentication for distributed queries</li></ul><h2 id=startstop-cluster>Start/Stop cluster</h2><ul><li>Don&rsquo;t delete the operator using:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete -f https://raw.githubusercontent.com/Altinity/clickhouse-operator/master/deploy/operator/clickhouse-operator-install-bundle.yaml
</span></span></code></pre></div><ul><li>kubectl delete chi cluster-name # chi is the name of the CRD clickhouseInstallation</li></ul><h2 id=delete-pvcs>DELETE PVCs</h2><p><a href=https://altinity.com/blog/preventing-clickhouse-storage-deletion-with-the-altinity-kubernetes-operator-reclaimpolicy target=_blank>https://altinity.com/blog/preventing-clickhouse-storage-deletion-with-the-altinity-kubernetes-operator-reclaimpolicy</a></p><h2 id=scaling>Scaling</h2><p>Best way is to scale down the deployments to 0 replicas, after that reboot the node and scale up again:</p><ol><li>first check that all your PVCs have the retain policy:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pv -o<span style=color:#ce5c00;font-weight:700>=</span>custom-columns<span style=color:#ce5c00;font-weight:700>=</span>PV:.metadata.name,NAME:.spec.claimRef.name,POLICY:.spec.persistentVolumeReclaimPolicy
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Patch it if you need</span>
</span></span><span style=display:flex><span>kubectl patch pv &lt;pv_id&gt; -p <span style=color:#4e9a06>&#39;{&#34;spec&#34;:{&#34;persistentVolumeReclaimPolicy&#34;:&#34;Retain&#34;}}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumeClaimTemplates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>XXX</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#204a87;font-weight:700>reclaimPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Retain</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=2><li>After that just create a stop.yaml and <code>kubectl apply -f stop.yaml</code></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClickHouseInstallation</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>stop</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>yes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=3><li>Reboot kubernetes node</li><li>Scale up deployment changing the stop property to no and do an <code>kubectl apply -f stop.yml</code></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClickHouseInstallation</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>stop</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=check-where-pods-are-executing>Check where pods are executing</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pod -o<span style=color:#ce5c00;font-weight:700>=</span>custom-columns<span style=color:#ce5c00;font-weight:700>=</span>NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName -n zk
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check which hosts in which AZs</span>
</span></span><span style=display:flex><span>kubectl get node -o<span style=color:#ce5c00;font-weight:700>=</span>custom-columns<span style=color:#ce5c00;font-weight:700>=</span>NODE:.metadata.name,ZONE:.metadata.labels.<span style=color:#4e9a06>&#39;failure-domain\.beta\.kubernetes\.io/zone&#39;</span>
</span></span></code></pre></div><h2 id=check-node-instance-types>Check node instance types:</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000>kubectl</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>get</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodes</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>o</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>json</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#000>jq</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>Cjr</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;.items[] | .metadata.name,&#34; &#34;,.metadata.labels.&#34;beta.kubernetes.io/instance-type&#34;,&#34; &#34;,.metadata.labels.&#34;beta.kubernetes.io/arch&#34;, &#34;\n&#34;&#39;</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#000>sort</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>k3</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>r</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>236</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>190</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>138</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>110</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>39</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>219</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>189</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>40</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>248</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>216</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>170</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>229</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>188</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>175</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>218</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>160</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>145</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>t4g</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arm64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>57</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m5</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>amd64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>146</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m5</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>large</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>amd64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m5</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>xlarge</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>amd64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>52</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m5</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>xlarge</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>amd64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>187</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m5</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>xlarge</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>amd64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>217</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>eu</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>central</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>compute</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>internal</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m5</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>xlarge</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>amd64</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=search-for-missing-affinity-rules>Search for missing affinity rules:</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -o json -n zk <span style=color:#000;font-weight:700>|</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>jq -r <span style=color:#4e9a06>&#34;[.items[] | {name: .metadata.name,\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06> affinity: .spec.affinity}]&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;name&#34;</span>: <span style=color:#4e9a06>&#34;zookeeper-0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;affinity&#34;</span>: null
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  . . .
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=storage-classes>Storage classes</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pvc -o<span style=color:#ce5c00;font-weight:700>=</span>custom-columns<span style=color:#ce5c00;font-weight:700>=</span>NAME:.metadata.name,SIZE:.spec.resources.requests.storage,CLASS:.spec.storageClassName,VOLUME:.spec.volumeName
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>NAME                         SIZE   CLASS   VOLUME
</span></span><span style=display:flex><span>datadir-volume-zookeeper-0   25Gi   gp2     pvc-9a3...9ee
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get storageclass/gp2 
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>NAME            PROVISIONER       RECLAIMPOLICY...   
</span></span><span style=display:flex><span>gp2 <span style=color:#ce5c00;font-weight:700>(</span>default<span style=color:#ce5c00;font-weight:700>)</span>   ebs.csi.aws.com   Delete
</span></span></code></pre></div><h2 id=using-csi-driver-to-protect-storage>Using CSI driver to protect storage:</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>allowVolumeExpansion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>storage.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StorageClass</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gp2-protected</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>encrypted</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gp2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>provisioner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ebs.csi.aws.com</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>reclaimPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Retain</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>volumeBindingMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>WaitForFirstConsumer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=enable-resize-of-volumes>Enable Resize of Volumes</h2><p>Operator does not delete volumes, so those were probably deleted by Kubernetes. In some new versions there is a feature flag that deletes PVCs attached to STS when STS is deleted.</p><p>Please try do the following: Use operator 0.20.3. Add the following to the defaults:
``</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>defaults</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>storageManagement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>provisioner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>That enables storage management by operator, instead of STS. It allows to extend volumes without re-creating STS, and us increase Volume size without restart of clickhouse statefulset pods for CSI drivers which support <code>allowVolumeExpansion</code> in storage classes because statefulset template don&rsquo;t change and we don&rsquo;t need delete/create statefulset</p><h2 id=change-server-settings>Change server settings:</h2><p><a href=https://github.com/Altinity/clickhouse-operator/issues/828 target=_blank>https://github.com/Altinity/clickhouse-operator/issues/828</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClickHouseInstallation</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>settings</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>max_concurrent_queries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>150</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Or <strong>edit ClickHouseInstallation:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n &lt;namespace&gt; get chi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME              CLUSTERS   HOSTS   STATUS      HOSTS-COMPLETED   AGE
</span></span><span style=display:flex><span>dnieto-test       <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>4</span>       Completed                     211d
</span></span><span style=display:flex><span>mbak-test         <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>1</span>       Completed                     44d
</span></span><span style=display:flex><span>rory-backupmar8   <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>4</span>       Completed                     42h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n &lt;namespace&gt; edit ClickHouseInstallation dnieto-test
</span></span></code></pre></div><h2 id=clickhouse-backup-for-chop>Clickhouse-backup for CHOP</h2><p>Examples for use clickhouse-backup + clickhouse-operator for EKS cluster which not managed by <code>altinity.cloud</code></p><p>Main idea: second container in clickhouse pod +  CronJob which will insert and poll <code>system.backup_actions</code> commands to execute clickhouse-backup commands</p><p><a href=https://github.com/AlexAkulov/clickhouse-backup/blob/master/Examples.md#how-to-use-clickhouse-backup-in-kubernetes target=_blank>https://github.com/AlexAkulov/clickhouse-backup/blob/master/Examples.md#how-to-use-clickhouse-backup-in-kubernetes</a></p><h2 id=configurations>Configurations:</h2><p>How to modify yaml configs:</p><p><a href=https://github.com/Altinity/clickhouse-operator/blob/dc6cdc6f2f61fc333248bb78a8f8efe792d14ca2/tests/e2e/manifests/chi/test-016-settings-04.yaml#L26 target=_blank>https://github.com/Altinity/clickhouse-operator/blob/dc6cdc6f2f61fc333248bb78a8f8efe792d14ca2/tests/e2e/manifests/chi/test-016-settings-04.yaml#L26</a></p><h2 id=clickhouse-operator-install-example>clickhouse-operator install Example:</h2><p>use latest release if possible
<a href=https://github.com/Altinity/clickhouse-operator/releases target=_blank>https://github.com/Altinity/clickhouse-operator/releases</a></p><ul><li>No. Nodes/replicas: 2 to 3 nodes with 500GB per node minimum</li><li>Zookeeper: 3 node ensemble</li><li>Type of instances: m6i.x4large to start with and you can go up to m6i.16xlarge</li><li>Persistent Storage/volumes: EBS gp2 for data and logs and gp3 for zookeeper</li></ul><h3 id=install-operator-in-namespace>Install operator in namespace</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Namespace to install operator into</span>
</span></span><span style=display:flex><span><span style=color:#000>OPERATOR_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>OPERATOR_NAMESPACE</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#000>dnieto</span><span style=color:#000;font-weight:700>-test-chop</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Namespace to install metrics-exporter into</span>
</span></span><span style=display:flex><span><span style=color:#000>METRICS_EXPORTER_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>OPERATOR_NAMESPACE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Operator&#39;s docker image</span>
</span></span><span style=display:flex><span><span style=color:#000>OPERATOR_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>OPERATOR_IMAGE</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#000>altinity</span><span style=color:#000;font-weight:700>/clickhouse-operator:</span><span style=color:#000>latest</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Metrics exporter&#39;s docker image</span>
</span></span><span style=display:flex><span><span style=color:#000>METRICS_EXPORTER_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>METRICS_EXPORTER_IMAGE</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#000>altinity</span><span style=color:#000;font-weight:700>/metrics-exporter:</span><span style=color:#000>latest</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Setup clickhouse-operator into specified namespace</span>
</span></span><span style=display:flex><span>kubectl apply --namespace<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>OPERATOR_NAMESPACE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> -f &lt;<span style=color:#ce5c00;font-weight:700>(</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    curl -s https://raw.githubusercontent.com/Altinity/clickhouse-operator/master/deploy/operator/clickhouse-operator-install-template.yaml <span style=color:#000;font-weight:700>|</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        <span style=color:#000>OPERATOR_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>OPERATOR_IMAGE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        <span style=color:#000>OPERATOR_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>OPERATOR_NAMESPACE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        <span style=color:#000>METRICS_EXPORTER_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>METRICS_EXPORTER_IMAGE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        <span style=color:#000>METRICS_EXPORTER_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>METRICS_EXPORTER_NAMESPACE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        envsubst <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=install-zookeeper-ensemble>Install zookeeper ensemble</h3><p>zookeepers will be named like zookeeper-0.zoons</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; kubectl create ns zoo3ns
</span></span><span style=display:flex><span>&gt; kubectl -n zoo3ns apply -f https://raw.githubusercontent.com/Altinity/clickhouse-operator/master/deploy/zookeeper/quick-start-persistent-volume/zookeeper-3-nodes-1GB-for-tests-only.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># check names they should be like:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># zookeeper.zoo3ns if using a new namespace</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If using the same namespace zookeeper.&lt;localnamespace&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># zookeeper must be accessed using the service like service_name.namespace</span>
</span></span></code></pre></div><h3 id=deploy-test-cluster>Deploy test cluster</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; kubectl -n dnieto-test-chop apply -f dnieto-test-chop.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># dnieto-test-chop.yaml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;clickhouse.altinity.com/v1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ClickHouseInstallation&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;dnieto-dev&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>configuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>settings</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	    </span><span style=color:#204a87;font-weight:700>max_concurrent_queries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;200&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>merge_tree/ttl_only_drop_parts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>profiles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	    </span><span style=color:#204a87;font-weight:700>default/queue_max_wait_ms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10000&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>readonly/readonly</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>admin/networks/ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#0000cf;font-weight:700>0.0.0.0</span><span style=color:#000>/0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#4e9a06>&#39;::/0&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>admin/password_sha256_hex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>admin/profile</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>admin/access_management</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	  </span><span style=color:#204a87;font-weight:700>zookeeper</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>nodes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>zookeeper.dnieto-test-chop</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2181</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>clusters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dnieto-dev</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>podTemplate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pod-template-with-volumes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>serviceTemplate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>chi-service-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>layout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>shardsCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># put the number of desired nodes 3 by default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>replicasCount</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>templates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>podTemplates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pod-template-with-volumes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse/clickhouse-server:22.3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#8f5902;font-style:italic># separate data from logs </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>data-storage-vc-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/clickhouse</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log-storage-vc-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/log/clickhouse-server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>serviceTemplates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>chi-service-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>generateName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;service-{chi}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># type ObjectMeta struct from k8s.io/meta/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>						</span><span style=color:#8f5902;font-style:italic># https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>						</span><span style=color:#8f5902;font-style:italic># this tags for elb load balancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic>#service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				    </span><span style=color:#8f5902;font-style:italic>#service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: &#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>						</span><span style=color:#8f5902;font-style:italic>#https://kubernetes.io/docs/concepts/services-networking/service/#aws-nlb-support</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				    </span><span style=color:#204a87;font-weight:700>service.beta.kubernetes.io/aws-load-balancer-internal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					  </span><span style=color:#204a87;font-weight:700>service.beta.kubernetes.io/aws-load-balancer-type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nlb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8123</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>client</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoadBalancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumeClaimTemplates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>data-storage-vc-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># no storageClassName - means use default storageClassName</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># storageClassName: default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># here if you have a storageClassName defined for gp2 you can use it.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># kubectl get storageclass</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>accessModes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>ReadWriteOnce</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>storage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>50Gi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>reclaimPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Retain</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log-storage-vc-template</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>accessModes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>ReadWriteOnce</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>requests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>storage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>2Gi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=install-monitoring>Install monitoring:</h3><p>In order to setup prometheus as a backend for all the asynchronous_metric_log / metric_log tables and also set up grafana dashboards:</p><ul><li><a href=https://github.com/Altinity/clickhouse-operator/blob/master/docs/prometheus_setup.md target=_blank>https://github.com/Altinity/clickhouse-operator/blob/master/docs/prometheus_setup.md</a></li><li><a href=https://github.com/Altinity/clickhouse-operator/blob/master/docs/grafana_setup.md target=_blank>https://github.com/Altinity/clickhouse-operator/blob/master/docs/grafana_setup.md</a></li><li><a href=https://github.com/Altinity/clickhouse-operator/blob/master/docs/monitoring_setup.md target=_blank>clickhouse-operator/monitoring_setup.md at master · Altinity/clickhouse-operator</a></li></ul><h2 id=extra-configs>Extra configs</h2><p>There is an admin user by default in the deployment that is used to admin stuff</p><h2 id=kubectl-chi-basic-comands>KUBECTL chi basic comands:</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>*&gt; kubectl get crd*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                                       CREATED AT
</span></span><span style=display:flex><span>clickhouseinstallations.clickhouse.altinity.com            2021-10-11T13:46:43Z
</span></span><span style=display:flex><span>clickhouseinstallationtemplates.clickhouse.altinity.com    2021-10-11T13:46:44Z
</span></span><span style=display:flex><span>clickhouseoperatorconfigurations.clickhouse.altinity.com   2021-10-11T13:46:44Z
</span></span><span style=display:flex><span>eniconfigs.crd.k8s.amazonaws.com                           2021-10-11T13:41:23Z
</span></span><span style=display:flex><span>grafanadashboards.integreatly.org                          2021-10-11T13:54:37Z
</span></span><span style=display:flex><span>grafanadatasources.integreatly.org                         2021-10-11T13:54:38Z
</span></span><span style=display:flex><span>grafananotificationchannels.integreatly.org                2022-05-17T14:27:48Z
</span></span><span style=display:flex><span>grafanas.integreatly.org                                   2021-10-11T13:54:37Z
</span></span><span style=display:flex><span>provisioners.karpenter.sh                                  2022-05-17T14:27:49Z
</span></span><span style=display:flex><span>securitygrouppolicies.vpcresources.k8s.aws                 2021-10-11T13:41:27Z
</span></span><span style=display:flex><span>volumesnapshotclasses.snapshot.storage.k8s.io              2022-04-22T13:34:20Z
</span></span><span style=display:flex><span>volumesnapshotcontents.snapshot.storage.k8s.io             2022-04-22T13:34:20Z
</span></span><span style=display:flex><span>volumesnapshots.snapshot.storage.k8s.io                    2022-04-22T13:34:20Z
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; *kubectl -n test-clickhouse-operator-dnieto2 get chi*
</span></span><span style=display:flex><span>NAME        CLUSTERS   HOSTS   STATUS   HOSTS-COMPLETED   AGE
</span></span><span style=display:flex><span>simple-01                                                 70m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; *kubectl -n test-clickhouse-operator-dnieto2 describe chi simple-01*
</span></span><span style=display:flex><span>Name:         simple-01
</span></span><span style=display:flex><span>Namespace:    test-clickhouse-operator-dnieto2
</span></span><span style=display:flex><span>Labels:       &lt;none&gt;
</span></span><span style=display:flex><span>Annotations:  &lt;none&gt;
</span></span><span style=display:flex><span>API Version:  clickhouse.altinity.com/v1
</span></span><span style=display:flex><span>Kind:         ClickHouseInstallation
</span></span><span style=display:flex><span>Metadata:
</span></span><span style=display:flex><span>  Creation Timestamp:  2023-01-09T20:38:06Z
</span></span><span style=display:flex><span>  Generation:          <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  Managed Fields:
</span></span><span style=display:flex><span>    API Version:  clickhouse.altinity.com/v1
</span></span><span style=display:flex><span>    Fields Type:  FieldsV1
</span></span><span style=display:flex><span>    fieldsV1:
</span></span><span style=display:flex><span>      f:metadata:
</span></span><span style=display:flex><span>        f:annotations:
</span></span><span style=display:flex><span>          .:
</span></span><span style=display:flex><span>          f:kubectl.kubernetes.io/last-applied-configuration:
</span></span><span style=display:flex><span>      f:spec:
</span></span><span style=display:flex><span>        .:
</span></span><span style=display:flex><span>        f:configuration:
</span></span><span style=display:flex><span>          .:
</span></span><span style=display:flex><span>          f:clusters:
</span></span><span style=display:flex><span>    Manager:         kubectl-client-side-apply
</span></span><span style=display:flex><span>    Operation:       Update
</span></span><span style=display:flex><span>    Time:            2023-01-09T20:38:06Z
</span></span><span style=display:flex><span>  Resource Version:  <span style=color:#0000cf;font-weight:700>267483138</span>
</span></span><span style=display:flex><span>  UID:               d7018efa-2b13-42fd-b1c5-b798fc6d0098
</span></span><span style=display:flex><span>Spec:
</span></span><span style=display:flex><span>  Configuration:
</span></span><span style=display:flex><span>    Clusters:
</span></span><span style=display:flex><span>      Name:  simple
</span></span><span style=display:flex><span>Events:      &lt;none&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; *kubectl get chi --all-namespaces*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAMESPACE                          NAME                             CLUSTERS   HOSTS   STATUS      HOSTS-COMPLETED   AGE
</span></span><span style=display:flex><span>andrey-dev                         <span style=color:#204a87>source</span>                           <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>1</span>       Completed                     38d
</span></span><span style=display:flex><span>eu                                 chi-dnieto-test-common-configd   <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>1</span>       Completed                     161d
</span></span><span style=display:flex><span>eu                                 dnieto-test                      <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>4</span>       Completed                     151d
</span></span><span style=display:flex><span>laszlo-dev                         node-rescale-2                   <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>4</span>       Completed                     5d13h
</span></span><span style=display:flex><span>laszlo-dev                         single                           <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>1</span>       Completed                     5d13h
</span></span><span style=display:flex><span>laszlo-dev2                        zk2                              <span style=color:#0000cf;font-weight:700>1</span>          <span style=color:#0000cf;font-weight:700>1</span>       Completed                     52d
</span></span><span style=display:flex><span>test-clickhouse-operator-dnieto2   simple-01
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; *kubectl -n test-clickhouse-operator-dnieto2 edit clickhouseinstallations.clickhouse.altinity.com simple-01
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Troubleshoot operator stuff</span>
</span></span><span style=display:flex><span>&gt; kubectl -n test-clickhouse-operator-ns edit chi
</span></span><span style=display:flex><span>&gt; kubectl -n test-clickhouse-operator describe chi
</span></span><span style=display:flex><span>&gt; kubectl -n test-clickhouse-operator get chi -o yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check operator logs usually located in kube-system or specific namespace</span>
</span></span><span style=display:flex><span>&gt; kubectl -n test-ns logs chi-operator-pod -f
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check output to yaml</span>
</span></span><span style=display:flex><span>&gt; kubectl -n test-ns get services -o yaml*
</span></span></code></pre></div><h2 id=problem-with-delete-finalizers>Problem with DELETE finalizers:</h2><p><a href=https://github.com/Altinity/clickhouse-operator/issues/830 target=_blank>https://github.com/Altinity/clickhouse-operator/issues/830</a></p><p>There&rsquo;s a problem with stuck finalizers that can cause old CHI installations to hang. The sequence of operations looks like this.</p><ol><li>You delete the existing ClickHouse operator using <code>kubectl delete -f operator-installation.yaml</code> with running CHI clusters.</li><li>You then drop the namespace where the CHI clusters are running, e.g., <code>kubectl delete ns my-namespace</code></li><li>This hangs. You run <code>kubectl get ns my-namespace -o yaml</code> and you&rsquo;ll see a message like the following: &ldquo;message: &lsquo;Some content in the namespace has finalizers remaining: <a href=http://finalizer.clickhouseinstallation.altinity.com/ target=_blank>finalizer.clickhouseinstallation.altinity.com</a>
&rdquo;</li></ol><p>That means the CHI can&rsquo;t delete because its finalizer was deleted out from under it.</p><p>The fix is to figure out the chi name which should still be visible and edit it to remove the finalizer reference.</p><ol><li><code>kubectl -n my-namespace get chi</code></li><li><code>kubectl -n my-namespace edit [clickhouseinstallations.clickhouse.altinity.com](http://clickhouseinstallations.clickhouse.altinity.com/) my-clickhouse-cluster</code></li></ol><p>Remove the finalizer from the spec, save it, and everything will delete properly.</p><p><strong><code>TIP: if you delete the ns too and there is no ns just create it and apply the above method</code></strong></p><h2 id=karpenter-scaler>Karpenter scaler</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubectl</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>n</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>karpenter</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>get</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>all</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME</span><span style=color:#f8f8f8;text-decoration:underline>                             </span><span style=color:#000>READY</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>STATUS</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>RESTARTS</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>AGE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>pod</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>75</span><span style=color:#000>c8b7667b</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>vbmj4</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>Running</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000>d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>pod</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>75</span><span style=color:#000>c8b7667b</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>wszxt</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>Running</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000>d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME</span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>TYPE</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>CLUSTER</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>IP</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>EXTERNAL</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>IP</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>PORT</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>S</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>AGE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>service</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>karpenter</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>ClusterIP</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>172</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>129</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>188</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>none</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>TCP</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>443</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000>d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME</span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#000>READY</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>UP</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#204a87>DATE</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>AVAILABLE</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>AGE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>deployment</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>apps</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>karpenter</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000>d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>NAME</span><span style=color:#f8f8f8;text-decoration:underline>                                   </span><span style=color:#000>DESIRED</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>CURRENT</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>READY</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>AGE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>replicaset</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>apps</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>75</span><span style=color:#000>c8b7667b</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000>d</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubectl</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>n</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>karpenter</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>logs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pod</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>75</span><span style=color:#000>c8b7667b</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>vbmj4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>44</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>269</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>Successfully</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>created</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>the</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>44</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>269</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>Logging</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>level</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>set</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>to</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>debug</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;level&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;info&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;ts&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1675665224</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>2755454</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;logger&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;fallback&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;caller&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;injection/injection.go:63&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;msg&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;Starting informers...&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>44</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>376</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>waiting</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>configmaps</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;configmaps&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;karpenter-global-settings&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>44</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>881</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#204a87;font-weight:700>global</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>settings</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;karpenter-global-settings&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>was</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>added</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>or</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>updated</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>settings</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Settings</span><span style=color:#a40000>{</span><span style=color:#000>BatchMaxDuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#000>v1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Duration</span><span style=color:#a40000>{</span><span style=color:#000>Duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>10000000000</span><span style=color:#a40000>}</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BatchIdleDuration</span><span style=color:#000;font-weight:700>:</span><span style=color:#000>v1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Duration</span><span style=color:#a40000>{</span><span style=color:#000>Duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1000000000</span><span style=color:#a40000>}}</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>44</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>881</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#204a87;font-weight:700>global</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>settings</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;karpenter-global-settings&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>was</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>added</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>or</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>updated</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>settings</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Settings</span><span style=color:#a40000>{</span><span style=color:#000>ClusterName</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;eu&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterEndpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;https://79974769E264251E43B18AF4CA31CE8C.gr7.eu-central-1.eks.amazonaws.com&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DefaultInstanceProfile</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;KarpenterNodeInstanceProfile-eu&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EnablePodENI</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EnableENILimitedPodDensity</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IsolatedVPC</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodeNameConvention</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;ip-name&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>VMMemoryOverheadPercent</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>075</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>InterruptionQueueName</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;Karpenter-eu&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#000>string</span><span style=color:#a40000>{}}</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>001</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>aws</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>discovered</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>region</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;region&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;eu-central-1&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>003</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>aws</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>unable</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>to</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>detect</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>the</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IP</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>of</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>the</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kube</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>dns</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>service</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>services</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kube-dns&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>is</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>forbidden</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>User</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;system:serviceaccount:karpenter:karpenter&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cannot</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>get</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resource</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;services&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>in</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>API</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>in</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>the</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>namespace</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kube-system&#34;</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Registering</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clients</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Registering</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>informer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>factories</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Registering</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>informers</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Registering</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>controllers</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>080</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>DEBUG</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>aws</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>discovered</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;v0.20.0&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>082</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>INFO</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>Starting</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>server</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/metrics&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;metrics&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addr&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;[::]:8080&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>082</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>INFO</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>Starting</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>server</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;health probe&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;addr&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;[::]:8081&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>I0206</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>182600</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>leaderelection</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>248</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>attempting</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>to</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>acquire</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>leader</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>lease</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>karpenter</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>leader</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>election</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>226</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>INFO</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>Starting</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>informers</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>417</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>INFO</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>aws</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>pricing</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>updated</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>spot</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pricing</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>instance</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>types</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>and</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>offerings</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;instance-type-count&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>607</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;offering-count&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1400</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>2023</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>06</span><span style=color:#000>T06</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>670</span><span style=color:#000>Z</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>INFO</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>controller</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>aws</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>pricing</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>updated</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>demand</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pricing</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#a40000>{</span><span style=color:#4e9a06>&#34;commit&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;f60dacd&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;instance-type-count&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>505</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=operator-affinities>Operator Affinities:</h2><p><img alt="Screenshot from 2023-02-21 11-26-36.png" src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/90052686-7c87-413f-95f7-41c12d233190/Screenshot_from_2023-02-21_11-26-36.png></p><h2 id=deploy-operator-with-clickhouse-keeper>Deploy operator with clickhouse-keeper</h2><p><a href=https://github.com/Altinity/clickhouse-operator/issues/959 target=_blank>https://github.com/Altinity/clickhouse-operator/issues/959</a>
<a href=https://github.com/Altinity/clickhouse-operator/blob/eb3fc4e28514d0d6ea25a40698205b02949bcf9d/docs/chi-examples/03-persistent-volume-07-do-not-chown.yaml target=_blank>setup-example.yaml</a></p><h2 id=possible-issues-with-running-clickhouse-in-k8s>Possible issues with running ClickHouse in K8s</h2><p>The biggest problem with running ClickHouse® in K8s, happens when clickhouse-server can&rsquo;t start for some reason and pod is falling in CrashloopBackOff, so you can&rsquo;t easily get in the pod and check/fix/restart ClickHouse.</p><p>There is multiple possible reasons for this, some of them can be fixed without manual intervention in pod:</p><ol><li>Wrong configuration files Fix: Check templates which are being used for config file generation and fix them.</li><li>While upgrade some backward incompatible changes prevents ClickHouse from start. Fix: Downgrade and check backward incompatible changes for all versions in between.</li></ol><p>Next reasons would require to have manual intervention in pod/volume.
There is two ways, how you can get access to data:</p><ol><li>Change entry point of ClickHouse pod to something else, so pod wouldn’t be terminated due ClickHouse error.</li><li>Attach ClickHouse data volume to some generic pod (like Ubuntu).</li><li>Unclear restart which produced broken files and/or state on disk is differs too much from state in zookeeper for replicated tables. Fix: Create <code>force_restore_data</code> flag.</li><li>Wrong file permission for ClickHouse files in pod. Fix: Use chown to set right ownership for files and directories.</li><li>Errors in ClickHouse table schema prevents ClickHouse from start. Fix: Rename problematic <code>table.sql</code> scripts to <code>table.sql.bak</code></li><li>Occasional failure of distributed queries because of wrong user/password. Due nature of k8s with dynamic ip allocations, it&rsquo;s possible that ClickHouse would cache wrong ip-> hostname combination and disallow connections because of mismatched hostname. Fix: run <code>SYSTEM DROP DNS CACHE;</code> <code>&lt;disable_internal_dns_cache>1&lt;/disable_internal_dns_cache></code> in config.xml.</li></ol><p>Caveats:</p><ol><li>Not all configuration/state folders are being covered by persistent volumes. (<a href=https://clickhouse.tech/docs/en/sql-reference/functions/ym-dict-functions/#multiple-geobases target=_blank rel=nofollow>geobases</a>
)</li><li>Page cache belongs to k8s node and pv are being mounted to pod, in case of fast shutdown there is possibility to loss some data(needs to be clarified)</li><li>Some cloud providers (GKE) can have slow unlink command, which is important for ClickHouse because it&rsquo;s needed for parts management. (<code>max_part_removal_threads</code> setting)</li></ol><p>Useful commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs chi-chcluster-2-1-0 -c clickhouse-pod -n chcluster --previous
</span></span><span style=display:flex><span>kubectl describe pod chi-chcluster-2-1-0 -n chcluster
</span></span></code></pre></div><p>Q. ClickHouse is caching the Kafka pod&rsquo;s IP and trying to connect to the same ip even when there is a new Kafka pod running and the old one is deprecated. Is there some setting where we could refresh the connection</p><p><code>&lt;disable_internal_dns_cache>1&lt;/disable_internal_dns_cache></code> in config.xml</p><h3 id=clickhouse-init-process-failed>ClickHouse init process failed</h3><p>It&rsquo;s due to low value for env <code>CLICKHOUSE_INIT_TIMEOUT</code> value. Consider increasing it up to 1 min.
<a href=https://github.com/ClickHouse/ClickHouse/blob/9f5cd35a6963cc556a51218b46b0754dcac7306a/docker/server/entrypoint.sh#L120 target=_blank>https://github.com/ClickHouse/ClickHouse/blob/9f5cd35a6963cc556a51218b46b0754dcac7306a/docker/server/entrypoint.sh#L120</a></p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2b3d7fdcfbffa725421e792b4bb3c072>1 - Istio Issues</h1><div class=lead>Working with the popular service mesh</div><h2 id=what-is-istio>What is Istio?</h2><p>Per documentation on <a href=https://istio.io/latest/docs/overview/what-is-istio/ target=_blank>Istio Project's website</a>
, Istio is &ldquo;an open source service mesh that layers transparently onto existing distributed applications. Istio’s powerful features provide a uniform and more efficient way to secure, connect, and monitor services. Istio is the path to load balancing, service-to-service authentication, and monitoring – with few or no service code changes.&rdquo;</p><p>Istio works quite well at providing this functionality, and does so through controlling service-to-service communication in a Cluster, find-grained control of traffic behavior, routing rules, load-balancing, a policy layer and configuration API supporting access controls, rate limiting, etc.</p><p>It also provides metrics about all traffic in a cluster. One can get an amazing amount of metrics from it. Datadog even has a provider that when turned on is a bit like a firehose of information.</p><p>Istio essentially uses a proxy to intercapt all network traffic and provides the ability to configured for providing a appliction-aware features.</p><h2 id=clickhouse-and-istio>ClickHouse and Istio</h2><p>The implications for ClickHouse need to be taken into consideration however, and this page will attempt to address this from real-life scenarios that Altinity devops, infrastructural, and support engineers have had to solve.</p><h3 id=operator-high-level-description>Operator High Level Description</h3><p>The Altinity ClickHouse Operator, when installed using a deployment, also creates four custom resources:</p><ul><li>clickhouseinstallations.clickhouse.altinity.com (chi)</li><li>clickhousekeeperinstallations.clickhouse-keeper.altinity.com (chk)</li><li>clickhouseinstallationtemplates.clickhouse.altinity.com (chit)</li><li>clickhouseoperatorconfigurations.clickhouse.altinity.com (chopconf)</li></ul><p>For the first two, it uses StatefullSets to run both Keeper and and ClickHouse clusters. For Keeper, it manages how many replicas specified, and for ClickHouse, it manages both how many replicas and shards are specified.</p><p>In managing <code>ClickHouseInstallations</code>, it requires that the operator can interact with the database running on clusters it creates using a specific <code>clickhouse_operator</code> user and needs network access rules that allow connection to the ClickHouse pods.</p><p>Many of the issues with Istio can pertain to issues where this can be a problem, particularly in the case where the IP address of the Operator pod changes and no longer is allowed to connect to it&rsquo;s ClickHouse clusters that it manages.</p><h3 id=issue-authentication-error-of-clickhouse-operator>Issue: Authentication error of clickhouse-operator</h3><p>This was a ClickHouse cluster running in a Kubernetes setup with Istio.</p><ul><li>The clickhouse operator was unable to query the clickhouse pods because of authentication errors. After a period of time, the operator gave up yet the ClickHouse cluster (ClickHouseInstallation) worked normally.</li><li>Errors showed <code>AUTHENTICATION_FAILED</code> and <code>connections from :ffff:127.0.0.6 are not allowed</code> as well as <code>IP_ADDRESS_NOT_ALLOWED</code></li><li>Also, the <code>clickhouse_operator</code> user correctly configured</li><li>There was a recent issue that on the surface looked similar to a recent issue with  https://altinity.com/blog/deepseek-clickhouse-and-the-altinity-kubernetes-operator (disabled network access for default user due to issue with DeepSeek) and one idea seemed as if upgrading the operator (which would fix the issue if it were default user).</li><li>However, the key to this issue is that the problem was with the <code>clickhouse_operator</code> user, not <code>default</code> user, hence not due to the aforementioned issue.</li><li>More consiration was given in light of how Istio effects what services can connect which made it more obvious that it was an issue with using Istio in the operator vs. operator version</li><li>The suggestion was given to remove istio from the clickhouse operator <code>ClickHouseInstallation</code> and references this issue <a href=https://github.com/Altinity/clickhouse-operator/issues/1261#issuecomment-1797895080 target=_blank>https://github.com/Altinity/clickhouse-operator/issues/1261#issuecomment-1797895080</a></li><li>The change required would be something of the sort:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse-operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>sidecar.istio.io/inject</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>clickouse.altinity.com/v1](http://clickouse.altinity.com/v1)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClickHouseInstallation</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>your-chi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>sidecar.istio.io/inject</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class="row footer-inner pb-3"><div class=col-12><a href=https://altinity.com target=_blank><img src=/images/general/altinity-logo_horizontal_blue_white.svg width=154 alt=Altinity.com></a></div></div><div class="row footer-inner py-3"><div class="col-12 col-sm-6 col-md-3"><ul class="nav flex-column mb-3"><li class=nav-item><b>PRODUCT</b></li><li class=nav-item><a href=https://altinity.com/managed-clickhouse/ target=_blank>Altinity.Cloud</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-support/ target=_blank>Support for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-training target=_blank>Training for ClickHouse</a></li><li class=nav-item><a href=https://altinity.com/clickhouse-pricing/ target=_blank>Altinity.Cloud Pricing</a></li><li class=nav-item><a href=https://altinity.com/plans-and-features-clickhouse/ target=_blank>Altinity Plans and Features</a></li></ul><div class="d-none d-md-block mb-3"><img decoding=async style="width:60px;display:inline-block;margin:0 10px 0 0" src=/images/general/soc.webp alt="SOC Certified"><img decoding=async style=width:60px;display:inline-block;margin:0 src=/images/general/soc2.webp alt="SOC2 TYPE II Certified"></div></div><div class="col-12 col-sm-6 col-md-3"><ul class="nav flex-column mb-3"><li class=nav-item><b>RESOURCES</b></li><li class=nav-item><a href=https://altinity.com/blog target=_blank>Blog</a></li><li class=nav-item><a href=https://docs.altinity.com/ target=_blank>Documentation</a></li><li class=nav-item><a href=https://kb.altinity.com/ target=_blank>Knowledge Base</a></li><li class=nav-item><a href=https://altinity.com/releases target=_blank>Altinity Stable Builds</a></li><li class=nav-item><a href=https://hubs.la/Q02pLTV20 target=_blank>Kubernetes Operator</a></li><li class=nav-item><a href=https://altinity.com/ecosystem/ target=_blank>Altinity Open Source Projects</a></li><li class=nav-item><a href=https://altinity.com/events/ target=_blank>Events</a></li></ul></div><div class="col-12 col-sm-6 col-md-3"><ul class="nav flex-column mb-3"><li class=nav-item><b>COMPANY</b></li><li class=nav-item><a href=https://altinity.com/about-us/ target=_blank>About Altinity</a></li><li class=nav-item><a href=https://altinity.com/about-us/press-releases target=_blank>Press Releases</a></li><li class=nav-item><a href=https://altinity.com/partners/ target=_blank>Partners</a></li><li class=nav-item><a href=https://altinity.com/customer-stories/ target=_blank>Customer Stories</a></li><li class=nav-item><a href=https://altinity.com/careers/ target=_blank>Careers</a></li><li class=nav-item><a href=https://altinity.com/contact/ target=_blank>Contact Us</a></li></ul></div><div class="col-12 col-sm-6 col-md-3">Get the latest ClickHouse news straight to your inbox every month.<br><a href=https://altinity.com/newsletter/ target=_blank class="btn btn-primary my-3" style=border-radius:1.5rem>Sign Up</a></div></div></div><div class="row footer-inner pb-3"><div class="col-12 col-sm-6 text-left text-xs-center py-2"><small class=text-white>&copy; 2026 Altinity Inc. Altinity®, Altinity.Cloud®, and Altinity Stable® are registered trademarks of Altinity, Inc. ClickHouse® is a registered trademark of ClickHouse, Inc.; Altinity is not affiliated with or associated with ClickHouse, Inc. Kafka, Kubernetes, MySQL, and PostgreSQL are trademarks and property of their respective owners. All Rights Reserved</small>
<small class=ml-1><a href=https://altinity.com/privacy-policy/ target=_blank>Privacy Policy</a></small></div><div class="col-12 col-sm-6 text-end text-xs-center"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://altinity.com/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=X aria-label=X><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/AltinityDB><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/company/altinity/><i class="fab fa-linkedin"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.youtube.com/channel/UCE3Y2lDKl_ZfjaCrh62onYA><i class="fab fa-youtube"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/Altinity/altinityknowledgebase><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Reddit aria-label=Reddit><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.reddit.com/r/Clickhouse/><i class="fab fa-reddit"></i></a></li></ul></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-101676615-2"></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/4536206.js></script><script type=text/javascript>!function(){var e,t="06536e793668baa",n=function(){Reo.init({clientID:"06536e793668baa"})};(e=document.createElement("script")).src="https://static.reo.dev/"+t+"/reo.js",e.defer=!0,e.onload=n,document.head.appendChild(e)}()</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-101676615-2")</script><script>$(document).ready(function(){$(".mobile-drop-toggle").on("click",function(){$(this).parent().parent().toggleClass("active")})})</script></footer><script type=text/javascript>_linkedin_partner_id="1601132",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id)</script><script type=text/javascript>(function(e){e||(window.lintrk=function(e,t){window.lintrk.q.push([e,t])},window.lintrk.q=[]);var n=document.getElementsByTagName("script")[0],t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",n.parentNode.insertBefore(t,n)})(window.lintrk)</script><noscript><img height=1 width=1 style=display:none alt src="https://px.ads.linkedin.com/collect/?pid=1601132&fmt=gif"></noscript></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>